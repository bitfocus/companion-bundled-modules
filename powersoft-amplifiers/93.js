"use strict";exports.id=93,exports.ids=[93],exports.modules={4093:function(t,n,e){var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(n,"__esModule",{value:!0}),n.readUdpStatus=async function(t,n){const e={channels:Array.from({length:n},()=>({}))};try{const n=(r=await c(t,a.STANDBY,Buffer.from([0,0,0,0]),!0)).length>=2?{ok:1===r[0],standbyRaw:r[1]}:{ok:!1};n.ok&&void 0!==n.standbyRaw&&(e.power=2===n.standbyRaw)}catch(t){}var r;try{const r=function(t,n){const e={ok:!1,channels:[]};if(t.length<2)return e;const r=1===t[0],o=t[1];e.ok=r;let a=2;const c=Math.min(o,n);for(let n=0;n<c&&!(a+6>t.length);n++){const r=t.readInt16LE(a);a+=2;const o=t.readInt16LE(a);a+=2;const c=t[a++],s=t[a++];e.channels[n]={inGain:r/100,outGain:o/100,inMute:1===c,outMute:1===s}}return e}(await c(t,a.READGM,Buffer.alloc(0)),n);if(r.ok)for(let t=0;t<Math.min(r.channels.length,n);t++){const n=r.channels[t];if(!n)continue;e.channels[t].mute=n.outMute??n.inMute;const o="number"==typeof n.outGain?n.outGain:n.inGain;"number"==typeof o&&(e.channels[t].gain=o)}}catch(t){}try{const r=function(t){if(t.length<1)return{ok:!1,fault:!1};if(1!==t[0])return{ok:!1,fault:!1};if(t.length<8)return{ok:!0,fault:!1};const n=t[1];let e=4;const r=t.readUInt32LE(e);e+=4;const o=[];for(let n=0;n<8&&e+4<=t.length;n++)o[n]=t.readUInt32LE(e),e+=4;return{ok:!0,fault:0!==(r??0)||o.some(t=>0!==(t??0)),gpio:n,global:r,channelWords:o}}(await c(t,a.READALLALARMS2,Buffer.alloc(0)));if(r.ok){e.fault=r.fault;const t=r.channelWords||[];for(let r=0;r<Math.min(t.length,n);r++){const n=t[r]>>>0;n&&(e.channels[r].clip=!!(1&n),e.channels[r].thermalSOA=!!(2&n),e.channels[r].overTemp=!!(8&n),e.channels[r].railFault=!!(16&n),e.channels[r].auxCurrentFault=!!(32&n),e.channels[r].otherFault=!!(64&n),e.channels[r].lowLoad=!!(128&n))}}}catch(t){}return e};const o=r(e(7194)),a={READGM:1,INFO:11,STANDBY:14,READALLALARMS2:25};async function c(t,n,e,r=!1){const c=t.host,s=t.devicePort??1234,l=t.timeoutMs??800,i=o.default.createSocket("udp4"),u=Math.floor(65535*Math.random()),f=await new Promise((t,n)=>{i.once("error",t=>n(t)),i.bind(0,()=>{const n=i.address();t("object"==typeof n?n.port:0)})}),h=t.answerPortZero?0:f,d=r||n===a.STANDBY,m=function(t,n,e,r,o=!1){const a=r.length,c=8+a+4,s=Buffer.alloc(c);let l=0;s[l++]=2,s[l++]=255&t,s.writeUInt16LE(65535&n,l),l+=2,s.writeUInt16LE(65535&a,l),l+=2,s.writeUInt16LE(65535&e,l),l+=2,a>0&&r.copy(s,l),l+=a;let i=0;return o||(i=function(t,n,e){let r=65535;for(let n=0;n<e;n++){r^=t[0+n];for(let t=0;t<8;t++){const t=1&r;r>>=1,t&&(r^=40961)}}return 65535&r}(s,0,8+a)),s.writeUInt16LE(65535&i,l),l+=2,s[l++]=255&~t,s[l++]=3,s}(n,u,h,e,d);return new Promise((t,e)=>{const r=setTimeout(()=>{i.close(),e(new Error("UDP timeout"))},l);i.once("message",o=>{clearTimeout(r),i.close();try{const r=function(t){if(t.length<12)throw new Error("UDP frame too short");const n=t[0],e=t[1],r=t.readUInt16LE(2),o=t.readUInt16LE(4),a=t.readUInt16LE(6),c=8+o;if(2!==n)throw new Error("Bad STX");if(t.length<c+4)throw new Error("Truncated frame");const s=t.readUInt16LE(c),l=t[c+1],i=t[c+2];return{STX:n,cmd:e,cookie:r,count:o,answerPort:a,data:t.subarray(8,c),crc16:s,notCmd:l,ETX:i}}(o);if((255&(255^r.cmd))!==n)return e(new Error("Unexpected cmd in response"));if(r.cookie!==u)return e(new Error("Cookie mismatch"));t(r.data)}catch(t){e(t instanceof Error?t:new Error(String(t)))}}),i.send(m,s,c,t=>{t&&(clearTimeout(r),i.close(),e(t instanceof Error?t:new Error(String(t))))})})}}};