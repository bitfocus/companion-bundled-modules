(()=>{var e={701:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getActions=function(e){return{addSheet:{name:"Add Sheet",options:[{type:"dropdown",label:"Spreadsheet",tooltip:"Spreadsheet to adjust",id:"spreadsheet",default:"",choices:[{label:"Select Spreadsheet",id:""},...e.config.sheetIDs.split(" ").filter((t=>{const r=e.data.sheetData.get(t);return void 0!==r?.properties?.title})).map(((t,r)=>{const s=e.data.sheetData.get(t);return s?{label:s.properties.title,id:e.config.referenceIndex?r.toString():t}:{label:"",id:""}})).filter((e=>""!==e.id))]},{type:"textinput",label:"Name",tooltip:"Name for the new Sheet",id:"name",default:"",useVariables:!0}],callback:async(t,r)=>{const s=await r.parseVariablesInString(t.options.name),n=parseInt(t.options.spreadsheet);if(e.config.referenceIndex&&isNaN(n))return;const i=e.config.sheetIDs.split(" ")[n];e.api.addSheet(i,s)}},adjustCell:{name:"Adjust Cell",options:[{type:"dropdown",label:"Type",tooltip:"Type of cell adjustment",id:"type",default:"Set",choices:[{label:"Set",id:"Set"},{label:"Increase",id:"Increase"},{label:"Decrease",id:"Decrease"}]},{type:"dropdown",label:"Spreadsheet",tooltip:"Spreadsheet to adjust",id:"spreadsheet",default:"",choices:[{label:"Select Spreadsheet",id:""},...e.config.sheetIDs.split(" ").map(((t,r)=>{const s=e.data.sheetData.get(t);return s?{label:s.properties.title,id:e.config.referenceIndex?r.toString():t}:{label:"",id:""}})).filter((e=>""!==e.id))]},{type:"textinput",label:"Cell",tooltip:"Sheet!A1 Notation",id:"cell",default:"",useVariables:!0},{type:"textinput",label:"Value",tooltip:"Value to set/increase/decrease",id:"value",default:"",useVariables:!0}],callback:async(t,r)=>{const s=await r.parseVariablesInString(t.options.cell);if(!s||!s.includes("!")||""===t.options.spreadsheet)return;let n=await r.parseVariablesInString(t.options.value),i=t.options.spreadsheet;if(e.config.referenceIndex){const r=parseInt(t.options.spreadsheet);if(isNaN(r))return;if(i=e.config.sheetIDs.split(" ")[r],void 0===i)return}if("Set"===t.options.type)e.log("debug",`Setting Sheet: ${i} Cell: ${s} Value: ${n}`),e.api.adjustCell(i,s,n);else{if(n=parseFloat(n),isNaN(n))return void e.log("warn",`Unable to adjust cell: ${n} is not a number`);const r=await e.api.parseCellValue(i,s);if(null===r)return;"Increase"===t.options.type?n=parseFloat(r)+n:"Decrease"===t.options.type&&(n=parseFloat(r)-n),e.log("debug",`Adjusting Sheet: ${t.options.spreadsheet} Cell: ${s} Value: ${n}`),e.api.adjustCell(i,s,n.toString())}}},clearSheet:{name:"Clear Sheet",options:[{type:"dropdown",label:"Spreadsheet",tooltip:"Spreadsheet to adjust",id:"spreadsheet",default:"",choices:[{label:"Select Spreadsheet",id:""},...e.config.sheetIDs.split(" ").filter((t=>{const r=e.data.sheetData.get(t);return void 0!==r?.properties?.title})).map(((t,r)=>{const s=e.data.sheetData.get(t);return s?{label:s.properties.title,id:e.config.referenceIndex?r.toString():t}:{label:"",id:""}})).filter((e=>""!==e.id))]},{type:"textinput",label:"Sheet to clear",id:"sheet",default:"",useVariables:!0}],callback:async(t,r)=>{let s=t.options.spreadsheet;if(e.config.referenceIndex){const r=parseInt(t.options.spreadsheet);if(isNaN(r))return;if(s=e.config.sheetIDs.split(" ")[r],void 0===s)return}const n=await r.parseVariablesInString(t.options.sheet);let i;e.data.sheetData.get(s).sheets.forEach((e=>{e?.properties?.title===n&&(i=e?.properties?.sheetId)})),void 0!==i?e.api.clearSheet(s,i):e.log("warn","Invalid sheet name")}},deleteRowColumn:{name:"Delete Rows or Columns",options:[{type:"dropdown",label:"Spreadsheet",tooltip:"Spreadsheet to adjust",id:"spreadsheet",default:"",choices:[{label:"Select Spreadsheet",id:""},...e.config.sheetIDs.split(" ").map(((t,r)=>{const s=e.data.sheetData.get(t);return s?{label:s.properties.title,id:e.config.referenceIndex?r.toString():t}:{label:"",id:""}})).filter((e=>""!==e.id))]},{type:"textinput",label:"Sheet Name",id:"sheet",default:"",useVariables:!0},{type:"dropdown",label:"Type",tooltip:"Type to delete",id:"type",default:"ROWS",choices:[{label:"Rows",id:"ROWS"},{label:"Columns",id:"COLUMNS"}]},{type:"textinput",label:"Row Start",tooltip:"Starting Row Number",id:"rowStart",default:"",useVariables:!0,isVisible:e=>"ROWS"===e.type},{type:"textinput",label:"Row Stop (non-inclusive)",tooltip:"Stop Row Number",id:"rowStop",default:"",useVariables:!0,isVisible:e=>"ROWS"===e.type},{type:"textinput",label:"Column Start",tooltip:"Starting Column Letter or Number",id:"columnStart",default:"",useVariables:!0,isVisible:e=>"COLUMNS"===e.type},{type:"textinput",label:"Column Stop (non-inclusive)",tooltip:"Stop Column Letter or Number",id:"columnStop",default:"",useVariables:!0,isVisible:e=>"COLUMNS"===e.type}],callback:async(t,r)=>{let n=t.options.spreadsheet;if(e.config.referenceIndex){const r=parseInt(t.options.spreadsheet);if(isNaN(r))return;if(n=e.config.sheetIDs.split(" ")[r],void 0===n)return}const i=await r.parseVariablesInString(t.options.sheet);let o;if(e.data.sheetData.get(n).sheets.forEach((e=>{e?.properties?.title===i&&(o=e?.properties?.sheetId)})),void 0!==o)if("ROWS"===t.options.type){const s=parseInt(await r.parseVariablesInString(t.options.rowStart)),i=parseInt(await r.parseVariablesInString(t.options.rowStop));e.api.deleteRowColumn(n,o,t.options.type,s-1,i-1)}else{let i=await r.parseVariablesInString(t.options.columnStart),a=await r.parseVariablesInString(t.options.columnStop);i=isNaN(parseInt(i))?(0,s.colToIndex)(i):parseInt(i)-1,a=isNaN(parseInt(a))?(0,s.colToIndex)(a):parseInt(a)-1,null!==i&&null!==a&&i<a?e.api.deleteRowColumn(n,o,t.options.type,i,a):e.log("warn","Invalid start and stop indexes")}else e.log("warn","Invalid sheet name")}},duplicateSheet:{name:"Duplicate Sheet",options:[{type:"dropdown",label:"Spreadsheet",tooltip:"Spreadsheet to adjust",id:"spreadsheet",default:"",choices:[{label:"Select Spreadsheet",id:""},...e.config.sheetIDs.split(" ").map(((t,r)=>{const s=e.data.sheetData.get(t);return s?{label:s.properties.title,id:e.config.referenceIndex?r.toString():t}:{label:"",id:""}})).filter((e=>""!==e.id))]},{type:"textinput",label:"Original Sheet Name",tooltip:"Name for the sheet to be duplicated",id:"duplicateName",default:"",useVariables:!0},{type:"textinput",label:"New Sheet Name",tooltip:"Name for the new sheet",id:"newName",default:"",useVariables:!0}],callback:async(t,r)=>{const s=await r.parseVariablesInString(t.options.duplicateName),n=await r.parseVariablesInString(t.options.newName),i=parseInt(t.options.spreadsheet);if(isNaN(i))return;const o=e.config.sheetIDs.split(" ")[i],a=e.data.sheetData.get(o);if(!a)return;const c=a.sheets.find((e=>e.properties.title===s));c?e.api.duplicateSheet(o,c.properties.sheetId,n,a.sheets.length):e.log("warn",`Unable to find sheet ${s} to duplicate`)}}}};const s=r(4703)},5750:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.API=void 0;const s=r(4703),n=r(6278);t.API=class{constructor(e){this.pollAPISheetData=0,this.rateLimit={backoff:0,interval:setInterval((()=>{["read","write","exceeded"].forEach((e=>{const t=e;this.rateLimit[t].push(0),this.rateLimit[t].shift()}))}),1e3),incrementRequest:e=>{this.rateLimit[e][this.rateLimit[e].length-1]++},exceeded:Array(60).fill(0),read:Array(60).fill(0),write:Array(60).fill(0)},this.ready=!1,this.refreshTokenInterval=setInterval((()=>{this.refreshToken()}),3e6),this.spreadsheetIndexToID=[],this.addSheet=async(e,t)=>{const r=`https://sheets.googleapis.com/v4/spreadsheets/${e}:batchUpdate?access_token=${this.instance.config.accessToken}`,s={requests:[{addSheet:{properties:{title:t}}}],includeSpreadsheetInResponse:!1,responseRanges:[],responseIncludeGridData:!1};fetch(r,{method:"POST",body:JSON.stringify(s)}).then((async e=>e.json())).then((e=>{e.error?(429===e.error.code?(this.instance.log("warn","Rate Limit exceeded"),this.rateLimit.incrementRequest("exceeded")):this.instance.log("warn",`API Error ${e.error.code}: ${e.error.message}`),this.instance.log("debug",e.error.message)):(this.instance.log("info",`Sheet ${t} added`),this.instance.log("debug",`Add Sheet Response: ${JSON.stringify(e)}`))})).catch((e=>{let t=e?.response?.body;try{t=JSON.parse(t),this.instance.log("warn",t.error.message),this.instance.log("debug",JSON.stringify(t))}catch(e){this.instance.log("warn","API Error - Unable to parse response"),this.instance.log("debug",`${e}`)}}))},this.adjustCell=async(e,t,r)=>{if(!this.ready||!this.instance.config.sheetIDs)return;const s=`https://sheets.googleapis.com/v4/spreadsheets/${e}/values/${encodeURIComponent(t)}?access_token=${this.instance.config.accessToken}&valueInputOption=USER_ENTERED`,n={range:t,values:[[r]]};fetch(s,{method:"PUT",body:JSON.stringify(n)}).then((async e=>e.json())).then((e=>{e.error?(429===e.error.code?(this.instance.log("warn","Rate Limit exceeded"),this.rateLimit.incrementRequest("exceeded")):this.instance.log("warn",`API Error ${e.error.code}: ${e.error.message}`),this.instance.log("debug",e.error.message)):(this.instance.log("info",`${t} successfully changed to ${r}`),this.instance.log("debug",`Adjust Cell Response: ${JSON.stringify(e)}`))})).catch((e=>{this.instance.log("warn",`Error changing cell: ${JSON.stringify(e)}`)}))},this.clearSheet=async(e,t)=>{if(!this.ready||!this.instance.config.sheetIDs)return;const r=`https://sheets.googleapis.com/v4/spreadsheets/${e}:batchUpdate?access_token=${this.instance.config.accessToken}`,s={requests:[{updateCells:{range:{sheetId:t},fields:"userEnteredValue"}}]},n={method:"POST",body:JSON.stringify(s)};return fetch(r,n).then((async e=>e.json())).then((e=>{e.error&&(429===e.error.code?(this.instance.log("warn","Rate Limit exceeded"),this.rateLimit.incrementRequest("exceeded")):this.instance.log("warn",`API Error ${e.error.code}: ${e.error.message}`),this.instance.log("debug",e.error.message))})).catch((e=>{this.instance.log("debug",`clearSheet err: ${e.message} - url: ${r}`),e.message.includes("429")&&this.rateLimit.incrementRequest("exceeded")}))},this.deleteRowColumn=async(e,t,r,s,n)=>{if(!this.ready||!this.instance.config.sheetIDs)return;const i=`https://sheets.googleapis.com/v4/spreadsheets/${e}:batchUpdate?access_token=${this.instance.config.accessToken}`,o={requests:[{deleteDimension:{range:{sheetId:t,dimension:r,startIndex:s,endIndex:n}}}]},a={method:"POST",body:JSON.stringify(o)};return fetch(i,a).then((async e=>e.json())).then((e=>{e.error&&(429===e.error.code?(this.instance.log("warn","Rate Limit exceeded"),this.rateLimit.incrementRequest("exceeded")):this.instance.log("warn",`API Error ${e.error.code}: ${e.error.message}`),this.instance.log("debug",e.error.message))})).catch((e=>{this.instance.log("debug",`deleteRowColumn err: ${e.message} - url: ${i}`),e.message.includes("429")&&this.rateLimit.incrementRequest("exceeded")}))},this.duplicateSheet=async(e,t,r,s)=>{const n=`https://sheets.googleapis.com/v4/spreadsheets/${e}:batchUpdate?access_token=${this.instance.config.accessToken}`,i={requests:[{duplicateSheet:{sourceSheetId:t,insertSheetIndex:s,newSheetName:r}}],includeSpreadsheetInResponse:!1,responseRanges:[],responseIncludeGridData:!1};fetch(n,{method:"POST",body:JSON.stringify(i)}).then((async e=>e.json())).then((e=>{this.instance.log("info",`Sheet ${r} added`),this.instance.log("debug",`Duplicating Sheet Response: ${JSON.stringify(e)}`)})).catch((e=>{let t=e?.response?.body;try{t=JSON.parse(t),this.instance.log("debug",JSON.stringify(t)),this.instance.log("warn",t.error.message)}catch(e){this.instance.log("warn","API Error - Unable to parse response"),this.instance.log("debug",`${e}`)}}))},this.auth=async()=>(this.instance.updateStatus(n.InstanceStatus.Connecting,"Authenticating"),!!await this.refreshToken()||!!await this.codeExchange()),this.codeExchange=async()=>{if(!this.instance.config.code)return!1;const e=new URLSearchParams([["code",this.instance.config.code],["client_id",this.instance.config.clientID],["client_secret",this.instance.config.clientSecret],["redirect_uri",this.instance.config.redirectURI],["grant_type","authorization_code"]]).toString();return this.instance.log("debug",`Attempting to exchange Code for Token - ${this.instance.config.code}`),fetch(`https://oauth2.googleapis.com/token?${e}`,{method:"POST"}).then((async e=>e.json())).then((e=>(this.instance.log("debug",`Exchanged code - ${JSON.stringify(e)}`),this.instance.updateStatus(n.InstanceStatus.Ok),this.instance.config.accessToken=e.access_token,this.instance.config.refreshToken=e.refresh_token,this.instance.config.code="",this.ready=!0,this.instance.saveConfig(this.instance.config),!0))).catch((e=>(this.instance.updateStatus(n.InstanceStatus.UnknownError,"Error exchanging code"),this.instance.log("warn",`Error exchanging code - ${e.message}`),this.instance.saveConfig({...this.instance.config,code:""}),!1)))},this.refreshToken=async()=>{if(!this.instance.config.clientID||!this.instance.config.clientSecret||!this.instance.config.refreshToken)return!1;this.instance.log("debug",`Attempting to refresh token - ${this.instance.config.refreshToken}`);const e=new URLSearchParams([["client_id",this.instance.config.clientID],["client_secret",this.instance.config.clientSecret],["refresh_token",this.instance.config.refreshToken],["grant_type","refresh_token"]]).toString();return fetch(`https://oauth2.googleapis.com/token?${e}`,{method:"POST"}).then((async e=>e.json())).then((e=>(this.instance.log("debug",`Token Refreshed - ${JSON.stringify(e)}`),this.instance.updateStatus(n.InstanceStatus.Ok),this.instance.config.accessToken=e.access_token,this.ready=!0,this.instance.saveConfig(this.instance.config),this.pollAPI(),!0))).catch((e=>(this.instance.log("error",e.message),!1)))},this.parseCellValue=async(e,t)=>{const r=await this.instance.parseVariablesInString(t)||"",n=this.instance.data.sheetValues.get(e);if(!n||""===r)return null;const i=(0,s.cellToIndex)(r.split("!")[1]);if(null===i)return null;const o=n.valueRanges.find((e=>e.range.split("!")[0]===r.split("!")[0]||e.range.split("!")[0]===`'${r.split("!")[0]}'`));if(!o)return this.instance.log("debug",`valueRanges - ${JSON.stringify(n.valueRanges)} -  ${r}`),null;const a=o.values[i.row]?.[i.col];return void 0!==a?a:null},this.pollAPI=async()=>{const e=new Date;if(!this.ready||!this.instance.config.sheetIDs)return void this.updatePollInterval(e);const t=async e=>{this.rateLimit.incrementRequest("read");const t=`https://sheets.googleapis.com/v4/spreadsheets/${e}?access_token=${this.instance.config.accessToken}`;return fetch(t).then((async e=>e.json())).then((t=>{t.error?(429===t.error.code?(this.instance.log("warn","Rate Limit exceeded"),this.rateLimit.incrementRequest("exceeded")):this.instance.log("warn",`API Error ${t.error.code}: ${t.error.message}`),this.instance.log("debug",t.error.message)):this.instance.data.sheetData.set(e,t)})).catch((e=>{this.instance.log("debug",`getSheet err: ${e.message}`),e.message.includes("429")&&this.rateLimit.incrementRequest("exceeded")}))},r=async e=>{this.rateLimit.incrementRequest("read");const t=this.instance.data.sheetData.get(e);if(!t)return;const r=t.sheets.map((e=>`'${encodeURIComponent(e.properties.title)}'`)),s=`https://sheets.googleapis.com/v4/spreadsheets/${e}/values:batchGet?access_token=${this.instance.config.accessToken}&ranges=${r.join("&ranges=")}`;return fetch(s).then((async e=>e.json())).then((r=>{if(r.error)429===r.error.code?(this.instance.log("warn","Rate Limit exceeded"),this.rateLimit.incrementRequest("exceeded")):this.instance.log("warn",`API Error ${r.error.code}: ${r.error.message}`),this.instance.log("debug",r.error.message);else{if(void 0===r.valueRanges)return;t.valueRanges=r.valueRanges,this.instance.data.sheetValues.set(e,t),this.instance.checkFeedbacks("cellValue")}})).catch((e=>{this.instance.log("debug",`getSheetValues err: ${e.message} - url: ${s}`),e.message.includes("429")&&this.rateLimit.incrementRequest("exceeded")}))},s=this.instance.config.sheetIDs.split(" ");if(this.spreadsheetIndexToID=s,0===this.pollAPISheetData){const n=[];s.forEach((e=>n.push(t(e)))),Promise.allSettled(n).then((async()=>{const e=[];return s.forEach((t=>e.push(r(t)))),Promise.allSettled(e)})).catch((e=>{this.instance.log("warn",`API Polling err: ${JSON.stringify(e)}`)})).finally((()=>{this.instance.updateInstance(),this.updatePollInterval(e)}))}else{const t=[];s.forEach((e=>t.push(r(e)))),Promise.allSettled(t).catch((e=>{this.instance.log("warn",`API Polling err: ${JSON.stringify(e)}`)})).finally((()=>{this.instance.updateInstance(),this.updatePollInterval(e)}))}this.pollAPISheetData=(this.pollAPISheetData+1)%4},this.updatePollInterval=(e=new Date)=>{if(this.instance.destroying)return;this.pollAPIInterval&&clearTimeout(this.pollAPIInterval);const t=(new Date).getTime()-e.getTime(),r=this.instance.config.pollInterval<.1?.1:this.instance.config.pollInterval,s=this.rateLimit.exceeded.reduce(((e,t)=>e+t),0);this.rateLimit.backoff=s>0?2**s*10:0;let n=1e3*r+this.rateLimit.backoff-t;n<0&&(n=0),this.pollAPIInterval=setTimeout((()=>{this.pollAPI()}),n)},this.instance=e,this.pollAPIInterval=setTimeout((()=>{this.pollAPI()}),1e3*this.instance.config.pollInterval)}}},7206:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getConfigFields=void 0,t.getConfigFields=e=>[{type:"static-text",id:"info",width:12,label:"Information",value:`This module requires creating an App in Googles Cloud Platform to gain access to read/write Google Sheets.\n\t\t\t\tPrerequisite: On the <a href="https://console.cloud.google.com/home/dashboard" target="_blank">Google Cloud Console</a> Create a Project, and in the APIs and services > Enabled APIs and servers, make sure you enable the Google Sheets API.\n\t\t\t\t<br/><br />\n        1. Go to <a href="https://console.cloud.google.com/apis/credentials" target="_blank">https://console.cloud.google.com/apis/credentials</a>, click 'Create Credentials', and select 'OAuth client ID'\n\t\t\t\t<br /><br />\n        2. Select 'Web Application' as the Application Type, and give the app a name.\n        <br /><br />\n        3. In the 'Authorised redirect URIs' section add a redirect to a localhost URL that's not in use, such as http://localhost:8001\n        <br /><br />\n        4. Copy and paste the Client ID, and Client Secret, and Redirect URI, into the config below. Click save, and then proceed to <a href="./instance/${e.label}/auth" target="_blank">Google Sheets Auth</a> and authenticate with the app (the auth URL is also available in the logs for this connection).\n\t\t\t\t<br /><br />\n\t\t\t\t5. After visiting the URL, and authorizing the app, you'll be redirected to your Redirect URL. Copy the "code" parameter that's in the URL of the redirect and paste that in the "Code" config below.\n\t\t\t\t`},{type:"textinput",label:"Client ID",id:"clientID",width:12,default:""},{type:"textinput",label:"Client Secret",id:"clientSecret",width:12,default:""},{type:"textinput",label:"Redirect URI",id:"redirectURI",width:12,default:""},{type:"textinput",label:"OAuth Code",id:"code",width:12,default:""},{type:"textinput",label:"Spreadsheet IDs (space separated)",id:"sheetIDs",width:12,default:""},{type:"checkbox",label:"Reference Spreadsheets by Index instead of ID (requires updating actions/feedbacks)",id:"referenceIndex",width:12,default:!1},{type:"static-text",id:"pollIntervalText",width:12,label:"Polling Interval Info",value:"By default Google allows for 1 request per second, but interval may take more 1 or 2 requests per spreadsheet. \n\t\t\tBecause of this, it is recommended to set the interval to around 1.3 x number of spreadsheets to avoid hitting the rate limit (which will start an increase backoff timer if it occurs)"},{type:"number",label:"API Poll Interval in Seconds",id:"pollInterval",width:12,default:1.5,min:.1,max:86400,step:.1},{type:"checkbox",label:"Clear existing OAuth tokens",id:"clearTokens",width:12,default:!1}]},1987:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getFeedbacks=function(e){return{cellValue:{type:"boolean",name:"Cell Value",description:"",options:[{type:"dropdown",label:"Spreadsheet",id:"spreadsheet",default:"",choices:[{label:"Select Spreadsheet",id:""},...e.config.sheetIDs.split(" ").map(((t,r)=>{const s=e.data.sheetData.get(t);return s?{label:s.properties.title,id:e.config.referenceIndex?r.toString():t}:{label:"",id:""}})).filter((e=>""!==e.id))]},{type:"textinput",label:"Cell (Sheet!A1)",id:"cell",default:"",useVariables:!0},{type:"dropdown",label:"Comparison",id:"comparison",default:"eq",choices:[{id:"eq",label:"="},{id:"ne",label:"!="},{id:"lt",label:"<"},{id:"lte",label:"<="},{id:"gt",label:">"},{id:"gte",label:">="}]},{type:"textinput",label:"Value",id:"value",default:"",useVariables:!0}],style:{bgcolor:(0,s.combineRgb)(255,0,0)},callback:async(t,r)=>{const s=await r.parseVariablesInString(t.options.cell),n=await r.parseVariablesInString(t.options.value);let i=t.options.spreadsheet;if(e.config.referenceIndex){const r=parseInt(t.options.spreadsheet);if(isNaN(r))return!1;if(i=e.config.sheetIDs.split(" ")[r],void 0===i)return!1}const o=await e.api.parseCellValue(i,s);return null!==o&&("eq"===t.options.comparison?o==n:"ne"===t.options.comparison?o!=n:"lt"===t.options.comparison?o<n:"lte"===t.options.comparison?o<=n:"gt"===t.options.comparison?o>n:"gte"===t.options.comparison&&o>=n)}}}};const s=r(6278)},8996:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.httpHandler=t.defaultHTTPRequest=void 0;const s=r(4703),n=r(2518);t.defaultHTTPRequest=()=>({method:"GET",path:"",headers:{},baseUrl:"",hostname:"",ip:"",originalUrl:"",query:{}}),t.httpHandler=async(e,t)=>{const r={status:404,headers:{"Content-Type":"application/json"},body:JSON.stringify({status:404,message:"Not Found"})},i={GET:{auth:()=>{if(e.config.clientID&&e.config.clientSecret&&e.config.redirectURI){const t=`https://accounts.google.com/o/oauth2/v2/auth?client_id=${e.config.clientID}&redirect_uri=${e.config.redirectURI}&response_type=code&scope=https://www.googleapis.com/auth/spreadsheets&prompt=consent&access_type=offline`;e.log("warn",`OAuth URL: ${t}`),r.status=302,r.headers={location:t}}else r.body=JSON.stringify({status:400,message:"Config is missing Client ID, Client Secret, and/or Redirect URI"})},spreadsheet:()=>{const i=t.query.id,o=t.query.sheet,a=t.query?.format||"json",c=e.data.sheetValues.get(i);if(c){const t=c.valueRanges.find((e=>o===e.range.split("!")[0]||`'${o}'`===e.range.split("!")[0]));if(t){r.status=200;const i=[];if("json"===a)t.values.forEach(((e,t)=>{i[t]={},e.forEach(((e,r)=>{i[t][(0,s.columnIndexToLetter)(r)]=e}))})),r.body=JSON.stringify(i,null,2);else if("csv"===a)try{const e={header:!1},s=new n.Parser(e).parse(t.values);r.body=s}catch(t){e.log("error","Error parsing spreadsheet JSON to CSV"),e.log("debug",`${t}`),r.body=JSON.stringify({status:500,message:"Error parsing spreadsheet JSON to CSV"})}else r.body=JSON.stringify({status:400,message:"Unsupported format type"})}else r.body=JSON.stringify({status:404,message:"Sheet Title not found"})}else r.body=JSON.stringify({status:404,message:"Spreadsheet ID not found"})},spreadsheets:()=>{const s=[];for(const[r,n]of e.data.sheetData.entries())s.push({id:r,title:n.properties.title,json:n.sheets.map((e=>`http://${t.headers.host}${t.baseUrl}/spreadsheet?id=${r}&format=json&sheet=${e.properties.title}`))||[],csv:n.sheets.map((e=>`http://${t.headers.host}${t.baseUrl}/spreadsheet?id=${r}&format=csv&sheet=${e.properties.title}`))||[]});r.status=200,r.body=JSON.stringify(s,null,2)}}},o=t.path.replace("/","").toLowerCase();return i[t.method][o]&&i[t.method][o](),r}},7806:(e,t,r)=>{"use strict";const s=r(6278),n=r(701),i=r(5750),o=r(7206),a=r(1987),c=r(8996),l=r(6450),u=r(8718),d=r(3911);class h extends s.InstanceBase{constructor(e){super(e),this.destroying=!1,this.config={clientID:"",clientSecret:"",redirectURI:"",code:"",sheetIDs:"",referenceIndex:!1,pollInterval:1.5,clearTokens:!1},this.data={sheetData:new Map,sheetValues:new Map},this.api=new i.API(this),this.variables=new d.Variables(this),this.instanceOptions.disableVariableValidation=!0}async init(e){this.config=e,this.updateInstance(),await this.configUpdated(e),this.log("info","Companion 3 makes some changes to Instance Variables, and limits certain symbols being used, such as !, so please check your variables are working and look at the examples showing how to reference A1 variable in each sheet")}async configUpdated(e){this.config=e,this.config.clearTokens&&(this.config.accessToken=void 0,this.config.refreshToken=void 0,this.config.code="",this.config.clearTokens=!1,this.log("info","Clearing Access and Refresh Tokens"),this.saveConfig(this.config)),await this.api.auth(),this.api.pollAPIInterval&&clearTimeout(this.api.pollAPIInterval),this.api.updatePollInterval(),this.updateInstance()}async destroy(){this.log("debug",`Instance destroyed: ${this.id}`),this.destroying=!0,this.api.pollAPIInterval&&clearTimeout(this.api.pollAPIInterval),this.api.refreshTokenInterval&&clearInterval(this.api.refreshTokenInterval)}getConfigFields(){return(0,o.getConfigFields)(this)}async updateInstance(){const e=(0,n.getActions)(this),t=(0,a.getFeedbacks)(this);this.setActionDefinitions(e),this.setFeedbackDefinitions(t),this.setPresetDefinitions((0,l.getPresets)(this)),this.variables.updateVariables()}async handleHttpRequest(e){return(0,c.httpHandler)(this,e)}}(0,s.runEntrypoint)(h,(0,u.getUpgrades)()),e.exports=h},6450:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPresets=function(e){return[]}},8718:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getUpgrades=void 0,t.getUpgrades=()=>[]},4703:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.cellToIndex=t.colToIndex=t.columnIndexToLetter=void 0,t.columnIndexToLetter=e=>{e+=1;let t,r="";for(;e>0;)t=(e-1)%26,r=String.fromCharCode(65+t)+r,e=(e-t)/26|0;return r||void 0},t.colToIndex=e=>{if("string"!=typeof e||e.length>2)return null;const t="A".charCodeAt(0);let r=e.charCodeAt(e.length-1)-t;return 2==e.length&&(r+=26*(e.charCodeAt(0)-t+1)),r},t.cellToIndex=e=>{const r=e.toUpperCase().match(/(^[A-Z]+)|([0-9]+$)/gm);if(null===r||2!=r.length)return null;const s=(0,t.colToIndex)(r[0]),n=(e=>parseInt(e,10)-1)(r[1]);return null===s||null===n?null:{row:n,col:s}}},3911:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Variables=void 0;const s=r(4703);t.Variables=class{constructor(e){this.currentVariables=new Map,this.currentDefinitions=new Map,this.sheetRange=new Map,this.updateVariables=()=>{const e=new Map,t=new Map,r=[];e.set("read_requests","Read Requests per Min"),t.set("read_requests",this.instance.api.rateLimit.read.reduce(((e,t)=>e+t),0)),e.set("write_requests","Write Requests per Min"),t.set("write_requests",this.instance.api.rateLimit.write.reduce(((e,t)=>e+t),0)),e.set("exceeded_requests","Requests Exceeded per Min"),t.set("exceeded_requests",this.instance.api.rateLimit.exceeded.reduce(((e,t)=>e+t),0)),e.set("backoff_timer","Request Backoff Timer"),t.set("backoff_timer",this.instance.api.rateLimit.backoff),this.instance.data.sheetValues.forEach(((n,i)=>{const o=this.instance.config.referenceIndex?this.instance.config.sheetIDs.split(" ").indexOf(i):n.properties.title;e.set(`${o}_id`,`Spreadsheet ${o} ID`),t.set(`${o}_id`,n.spreadsheetId),this.instance.config.referenceIndex?(e.set(`${o}_title`,`Spreadsheet ${o} Title`),t.set(`${o}_title`,n.properties.title)):(e.set(`${o}_index`,`Spreadsheet ${o} Index`),t.set(`${o}_index`,this.instance.config.sheetIDs.split(" ").indexOf(i))),n.sheets?.forEach((r=>{e.set(`${o}_sheet_${r.properties.index}`,`${o} Sheet ${r.properties.index} Title`),t.set(`${o}_sheet_${r.properties.index}`,r.properties.title)})),n.valueRanges?.forEach((n=>{let i=n.range.split("!")[0];i.startsWith("'")&&i.endsWith("'")&&(i=i.slice(1,-1)),i=i.replace(/#/g,""),r.push(`${o}_${i}`);const a=this.sheetRange.get(`${o}_${i}`),c=a?a.rows:0,l=a?a.columns:0,u=n?.values?.length||0;let d=0;if(n?.values?.forEach((e=>{e.length>d&&(d=e.length)})),u<c||d<l){if(u<c)for(let e=u;e<c;e++)for(let r=0;r<l;r++)t.set(`${o}_${i}!${(0,s.columnIndexToLetter)(r)}${e+1}`,void 0);if(d<l)for(let e=d;e<l;e++)for(let r=0;r<c;r++)t.set(`${o}_${i}!${(0,s.columnIndexToLetter)(e)}${r+1}`,void 0)}this.sheetRange.set(`${o}_${i}`,{rows:u,columns:d}),void 0===n.values&&(e.set(`${o}_${i}!A1`,`Example ${o} ${i}!A1`),t.set(`${o}_${i}!A1`,""));for(let r=0;r<u;r++)for(let a=0;a<d;a++){const c=n.values[r]?.[a]||"";0===r&&0===a&&e.set(`${o}_${i}!${(0,s.columnIndexToLetter)(a)}${r+1}`,`Example ${o} ${i}!${(0,s.columnIndexToLetter)(a)}${r+1}`),t.set(`${o}_${i}!${(0,s.columnIndexToLetter)(a)}${r+1}`,c)}}))})),[...this.sheetRange.keys()].forEach((e=>{if(!r.includes(e)){const r=this.sheetRange.get(e);this.instance.log("debug",`Clearing variables for missing sheet ${e}`);for(let n=0;n<r.rows;n++)for(let i=0;i<r.columns;i++)t.set(`${e}!${(0,s.columnIndexToLetter)(i)}${n+1}`,void 0);this.sheetRange.delete(e)}}));let n=!1;e.forEach(((e,t)=>{this.currentDefinitions.get(t)!==e&&(n=!0)})),this.currentDefinitions.forEach(((t,r)=>{e.get(r)!==t&&(n=!0)})),n&&(this.instance.log("debug","Setting new variable definitions"),this.instance.setVariableDefinitions([...e.entries()].map((e=>({variableId:e[0].replace(/ /g,"_").replace(/!/g,"_").replace(/'/g,"").replace(/\(/g,"").replace(/\)/g,""),name:e[1]})))),this.currentDefinitions=e);const i={};t.forEach(((e,t)=>{this.currentVariables.get(t)!==e&&(i[t.replace(/ /g,"_").replace(/!/g,"_").replace(/'/g,"").replace(/\(/g,"").replace(/\)/g,"")]=void 0===e?void 0:e+"")})),Object.keys(i).length>0&&(this.instance.setVariableValues(i),this.currentVariables=t,Object.keys(i).length>1e3&&this.instance.log("debug",`Updating ${Object.keys(i).length} of ${t.size} variables`))},this.instance=e}}},7169:(e,t,r)=>{"use strict";const s=r(2017);s.code='require("ajv/dist/runtime/equal").default',t.A=s},6284:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});var r={grad:.9,turn:360,rad:360/(2*Math.PI)},s=function(e){return"string"==typeof e?e.length>0:"number"==typeof e},n=function(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=Math.pow(10,t)),Math.round(r*e)/r+0},i=function(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=1),e>r?r:e>t?e:t},o=function(e){return(e=isFinite(e)?e%360:0)>0?e:e+360},a=function(e){return{r:i(e.r,0,255),g:i(e.g,0,255),b:i(e.b,0,255),a:i(e.a)}},c=function(e){return{r:n(e.r),g:n(e.g),b:n(e.b),a:n(e.a,3)}},l=/^#([0-9a-f]{3,8})$/i,u=function(e){var t=e.toString(16);return t.length<2?"0"+t:t},d=function(e){var t=e.r,r=e.g,s=e.b,n=e.a,i=Math.max(t,r,s),o=i-Math.min(t,r,s),a=o?i===t?(r-s)/o:i===r?2+(s-t)/o:4+(t-r)/o:0;return{h:60*(a<0?a+6:a),s:i?o/i*100:0,v:i/255*100,a:n}},h=function(e){var t=e.h,r=e.s,s=e.v,n=e.a;t=t/360*6,r/=100,s/=100;var i=Math.floor(t),o=s*(1-r),a=s*(1-(t-i)*r),c=s*(1-(1-t+i)*r),l=i%6;return{r:255*[s,a,o,o,c,s][l],g:255*[c,s,s,a,o,o][l],b:255*[o,o,c,s,s,a][l],a:n}},p=function(e){return{h:o(e.h),s:i(e.s,0,100),l:i(e.l,0,100),a:i(e.a)}},f=function(e){return{h:n(e.h),s:n(e.s),l:n(e.l),a:n(e.a,3)}},b=function(e){return h((r=(t=e).s,{h:t.h,s:(r*=((s=t.l)<50?s:100-s)/100)>0?2*r/(s+r)*100:0,v:s+r,a:t.a}));var t,r,s},g=function(e){return{h:(t=d(e)).h,s:(n=(200-(r=t.s))*(s=t.v)/100)>0&&n<200?r*s/100/(n<=100?n:200-n)*100:0,l:n/2,a:t.a};var t,r,s,n},y=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,m=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,_=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,v=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,I={string:[[function(e){var t=l.exec(e);return t?(e=t[1]).length<=4?{r:parseInt(e[0]+e[0],16),g:parseInt(e[1]+e[1],16),b:parseInt(e[2]+e[2],16),a:4===e.length?n(parseInt(e[3]+e[3],16)/255,2):1}:6===e.length||8===e.length?{r:parseInt(e.substr(0,2),16),g:parseInt(e.substr(2,2),16),b:parseInt(e.substr(4,2),16),a:8===e.length?n(parseInt(e.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(e){var t=_.exec(e)||v.exec(e);return t?t[2]!==t[4]||t[4]!==t[6]?null:a({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:void 0===t[7]?1:Number(t[7])/(t[8]?100:1)}):null},"rgb"],[function(e){var t=y.exec(e)||m.exec(e);if(!t)return null;var s,n,i=p({h:(s=t[1],n=t[2],void 0===n&&(n="deg"),Number(s)*(r[n]||1)),s:Number(t[3]),l:Number(t[4]),a:void 0===t[5]?1:Number(t[5])/(t[6]?100:1)});return b(i)},"hsl"]],object:[[function(e){var t=e.r,r=e.g,n=e.b,i=e.a,o=void 0===i?1:i;return s(t)&&s(r)&&s(n)?a({r:Number(t),g:Number(r),b:Number(n),a:Number(o)}):null},"rgb"],[function(e){var t=e.h,r=e.s,n=e.l,i=e.a,o=void 0===i?1:i;if(!s(t)||!s(r)||!s(n))return null;var a=p({h:Number(t),s:Number(r),l:Number(n),a:Number(o)});return b(a)},"hsl"],[function(e){var t=e.h,r=e.s,n=e.v,a=e.a,c=void 0===a?1:a;if(!s(t)||!s(r)||!s(n))return null;var l=function(e){return{h:o(e.h),s:i(e.s,0,100),v:i(e.v,0,100),a:i(e.a)}}({h:Number(t),s:Number(r),v:Number(n),a:Number(c)});return h(l)},"hsv"]]},T=function(e,t){for(var r=0;r<t.length;r++){var s=t[r][0](e);if(s)return[s,t[r][1]]}return[null,void 0]},E=function(e){return"string"==typeof e?T(e.trim(),I.string):"object"==typeof e&&null!==e?T(e,I.object):[null,void 0]},A=function(e,t){var r=g(e);return{h:r.h,s:i(r.s+100*t,0,100),l:r.l,a:r.a}},S=function(e){return(299*e.r+587*e.g+114*e.b)/1e3/255},k=function(e,t){var r=g(e);return{h:r.h,s:r.s,l:i(r.l+100*t,0,100),a:r.a}},w=function(){function e(e){this.parsed=E(e)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return e.prototype.isValid=function(){return null!==this.parsed},e.prototype.brightness=function(){return n(S(this.rgba),2)},e.prototype.isDark=function(){return S(this.rgba)<.5},e.prototype.isLight=function(){return S(this.rgba)>=.5},e.prototype.toHex=function(){return t=(e=c(this.rgba)).r,r=e.g,s=e.b,o=(i=e.a)<1?u(n(255*i)):"","#"+u(t)+u(r)+u(s)+o;var e,t,r,s,i,o},e.prototype.toRgb=function(){return c(this.rgba)},e.prototype.toRgbString=function(){return t=(e=c(this.rgba)).r,r=e.g,s=e.b,(n=e.a)<1?"rgba("+t+", "+r+", "+s+", "+n+")":"rgb("+t+", "+r+", "+s+")";var e,t,r,s,n},e.prototype.toHsl=function(){return f(g(this.rgba))},e.prototype.toHslString=function(){return t=(e=f(g(this.rgba))).h,r=e.s,s=e.l,(n=e.a)<1?"hsla("+t+", "+r+"%, "+s+"%, "+n+")":"hsl("+t+", "+r+"%, "+s+"%)";var e,t,r,s,n},e.prototype.toHsv=function(){return e=d(this.rgba),{h:n(e.h),s:n(e.s),v:n(e.v),a:n(e.a,3)};var e},e.prototype.invert=function(){return L({r:255-(e=this.rgba).r,g:255-e.g,b:255-e.b,a:e.a});var e},e.prototype.saturate=function(e){return void 0===e&&(e=.1),L(A(this.rgba,e))},e.prototype.desaturate=function(e){return void 0===e&&(e=.1),L(A(this.rgba,-e))},e.prototype.grayscale=function(){return L(A(this.rgba,-1))},e.prototype.lighten=function(e){return void 0===e&&(e=.1),L(k(this.rgba,e))},e.prototype.darken=function(e){return void 0===e&&(e=.1),L(k(this.rgba,-e))},e.prototype.rotate=function(e){return void 0===e&&(e=15),this.hue(this.hue()+e)},e.prototype.alpha=function(e){return"number"==typeof e?L({r:(t=this.rgba).r,g:t.g,b:t.b,a:e}):n(this.rgba.a,3);var t},e.prototype.hue=function(e){var t=g(this.rgba);return"number"==typeof e?L({h:e,s:t.s,l:t.l,a:t.a}):n(t.h)},e.prototype.isEqual=function(e){return this.toHex()===L(e).toHex()},e}(),L=function(e){return e instanceof w?e:new w(e)},O=[];t.Colord=w,t.colord=L,t.extend=function(e){e.forEach((function(e){O.indexOf(e)<0&&(e(w,I),O.push(e))}))},t.getFormat=function(e){return E(e)[1]},t.random=function(){return new w({r:255*Math.random(),g:255*Math.random(),b:255*Math.random()})}},6022:e=>{!function(){"use strict";var t=[,function(e,t){function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,s=new Array(t);r<t;r++)s[r]=e[r];return s}function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.lengthOf=t.keysOf=t.isObject=t.isInfOrNaN=t.isFunction=t.isArguments=t.hasOwn=t.handleError=t.convertMapToObject=t.checkError=void 0,t.isFunction=function(e){return"function"==typeof e},t.isObject=function(e){return"object"===s(e)},t.keysOf=function(e){return Object.keys(e)},t.lengthOf=function(e){return Object.keys(e).length};var n=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};t.hasOwn=n,t.convertMapToObject=function(e){return Array.from(e).reduce((function(e,t){var s,n,i=(n=2,function(e){if(Array.isArray(e))return e}(s=t)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var s,n,i=[],o=!0,a=!1;try{for(r=r.call(e);!(o=(s=r.next()).done)&&(i.push(s.value),!t||i.length!==t);o=!0);}catch(e){a=!0,n=e}finally{try{o||null==r.return||r.return()}finally{if(a)throw n}}return i}}(s,n)||function(e,t){if(e){if("string"==typeof e)return r(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);return"Object"===s&&e.constructor&&(s=e.constructor.name),"Map"===s||"Set"===s?Array.from(e):"Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?r(e,t):void 0}}(s,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=i[0],a=i[1];return e[o]=a,e}),{})},t.isArguments=function(e){return null!=e&&n(e,"callee")},t.isInfOrNaN=function(e){return Number.isNaN(e)||e===1/0||e===-1/0};var i={maxStack:function(e){return new RegExp("Maximum call stack size exceeded","g").test(e)}};t.checkError=i,t.handleError=function(e){return function(){try{return e.apply(this,arguments)}catch(e){if(i.maxStack(e.message))throw new Error("Converting circular structure to JSON");throw e}}}},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Base64=void 0;for(var r=Object.create(null),s=function(e){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e)},n=0;n<64;n++)r[s(n)]=n;var i=function(e){if("undefined"==typeof Uint8Array||"undefined"==typeof ArrayBuffer){for(var t=[],r=0;r<e;r++)t.push(0);return t.$Uint8ArrayPolyfill=!0,t}return new Uint8Array(new ArrayBuffer(e))},o={encode:function(e){if("string"==typeof e){var t=e;e=i(t.length);for(var r=0;r<t.length;r++){var n=t.charCodeAt(r);if(n>255)throw new Error("Not ascii. Base64.encode can only take ascii strings.");e[r]=n}}for(var o=[],a=null,c=null,l=null,u=null,d=0;d<e.length;d++)switch(d%3){case 0:a=e[d]>>2&63,c=(3&e[d])<<4;break;case 1:c|=e[d]>>4&15,l=(15&e[d])<<2;break;case 2:l|=e[d]>>6&3,u=63&e[d],o.push(s(a)),o.push(s(c)),o.push(s(l)),o.push(s(u)),a=null,c=null,l=null,u=null}return null!=a&&(o.push(s(a)),o.push(s(c)),null==l?o.push("="):o.push(s(l)),null==u&&o.push("=")),o.join("")},decode:function(e){var t=Math.floor(3*e.length/4);"="==e.charAt(e.length-1)&&(t--,"="==e.charAt(e.length-2)&&t--);for(var s,n=i(t),o=null,a=null,c=null,l=0,u=0;u<e.length;u++){var d="="===(s=e.charAt(u))?-1:r[s];switch(u%4){case 0:if(d<0)throw new Error("invalid base64 string");o=d<<2;break;case 1:if(d<0)throw new Error("invalid base64 string");o|=d>>4,n[l++]=o,a=(15&d)<<4;break;case 2:d>=0&&(a|=d>>2,n[l++]=a,c=(3&d)<<6);break;case 3:d>=0&&(n[l++]=c|d)}}return n},newBinary:i};t.Base64=o},function(e){e.exports={_noYieldsAllowed:function(e){return e()}}},function(e,t){function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function s(e){return JSON.stringify(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=function e(t,n,i,o,a){var c=n[t];switch(r(c)){case"string":return s(c);case"number":return isFinite(c)?String(c):"null";case"boolean":return String(c);case"object":if(!c)return"null";var l,u=o+i,d=[];if(Array.isArray(c)||{}.hasOwnProperty.call(c,"callee")){for(var h=c.length,p=0;p<h;p+=1)d[p]=e(p,c,i,u,a)||"null";return l=0===d.length?"[]":u?"[\n"+u+d.join(",\n"+u)+"\n"+o+"]":"["+d.join(",")+"]"}var f=Object.keys(c);return a&&(f=f.sort()),f.forEach((function(t){(l=e(t,c,i,u,a))&&d.push(s(t)+(u?": ":":")+l)})),l=0===d.length?"{}":u?"{\n"+u+d.join(",\n"+u)+"\n"+o+"}":"{"+d.join(",")+"}"}};t.default=function(e,t){var r=Object.assign({indent:"",canonical:!1},t);if(!0===r.indent)r.indent="  ";else if("number"==typeof r.indent){for(var s="",i=0;i<r.indent;i++)s+=" ";r.indent=s}return n("",{"":e},r.indent,"",r.canonical)},e.exports=t.default}],r={};function s(e){var n=r[e];if(void 0!==n)return n.exports;var i=r[e]={exports:{}};return t[e](i,i.exports,s),i.exports}var n={};!function(){var e=n,t=s(2).Base64,r=s(3);Object.defineProperty(e,"__esModule",{value:!0}),e.EJSON=void 0;var i=s(1),o={};e.EJSON=o;var a=new Map;o.addType=function(e,t){if(a.has(e))throw new Error("Type ".concat(e," already present"));a.set(e,t)};var c=[{matchJSONValue:function(e){return(0,i.hasOwn)(e,"$date")&&1===(0,i.lengthOf)(e)},matchObject:function(e){return e instanceof Date},toJSONValue:function(e){return{$date:e.getTime()}},fromJSONValue:function(e){return new Date(e.$date)}},{matchJSONValue:function(e){return(0,i.hasOwn)(e,"$regexp")&&(0,i.hasOwn)(e,"$flags")&&2===(0,i.lengthOf)(e)},matchObject:function(e){return e instanceof RegExp},toJSONValue:function(e){return{$regexp:e.source,$flags:e.flags}},fromJSONValue:function(e){return new RegExp(e.$regexp,e.$flags.slice(0,50).replace(/[^gimuy]/g,"").replace(/(.)(?=.*\1)/g,""))}},{matchJSONValue:function(e){return(0,i.hasOwn)(e,"$InfNaN")&&1===(0,i.lengthOf)(e)},matchObject:i.isInfOrNaN,toJSONValue:function(e){return{$InfNaN:Number.isNaN(e)?0:e===1/0?1:-1}},fromJSONValue:function(e){return e.$InfNaN/0}},{matchJSONValue:function(e){return(0,i.hasOwn)(e,"$binary")&&1===(0,i.lengthOf)(e)},matchObject:function(e){return"undefined"!=typeof Uint8Array&&e instanceof Uint8Array||e&&(0,i.hasOwn)(e,"$Uint8ArrayPolyfill")},toJSONValue:function(e){return{$binary:t.encode(e)}},fromJSONValue:function(e){return t.decode(e.$binary)}},{matchJSONValue:function(e){return(0,i.hasOwn)(e,"$escape")&&1===(0,i.lengthOf)(e)},matchObject:function(e){var t=!1;if(e){var r=(0,i.lengthOf)(e);1!==r&&2!==r||(t=c.some((function(t){return t.matchJSONValue(e)})))}return t},toJSONValue:function(e){var t={};return(0,i.keysOf)(e).forEach((function(r){t[r]=o.toJSONValue(e[r])})),{$escape:t}},fromJSONValue:function(e){var t={};return(0,i.keysOf)(e.$escape).forEach((function(r){t[r]=o.fromJSONValue(e.$escape[r])})),t}},{matchJSONValue:function(e){return(0,i.hasOwn)(e,"$type")&&(0,i.hasOwn)(e,"$value")&&2===(0,i.lengthOf)(e)},matchObject:function(e){return o._isCustomType(e)},toJSONValue:function(e){var t=r._noYieldsAllowed((function(){return e.toJSONValue()}));return{$type:e.typeName(),$value:t}},fromJSONValue:function(e){var t=e.$type;if(!a.has(t))throw new Error("Custom EJSON type ".concat(t," is not defined"));var s=a.get(t);return r._noYieldsAllowed((function(){return s(e.$value)}))}}];o._isCustomType=function(e){return e&&(0,i.isFunction)(e.toJSONValue)&&(0,i.isFunction)(e.typeName)&&a.has(e.typeName())},o._getTypes=function(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?a:(0,i.convertMapToObject)(a)},o._getConverters=function(){return c};var l=function(e){for(var t=0;t<c.length;t++){var r=c[t];if(r.matchObject(e))return r.toJSONValue(e)}},u=function e(t){if(null===t)return null;var r=l(t);return void 0!==r?r:(0,i.isObject)(t)?((0,i.keysOf)(t).forEach((function(r){var s=t[r];if((0,i.isObject)(s)||void 0===s||(0,i.isInfOrNaN)(s)){var n=l(s);n?t[r]=n:e(s)}})),t):t};o._adjustTypesToJSONValue=u,o.toJSONValue=function(e){var t=l(e);if(void 0!==t)return t;var r=e;return(0,i.isObject)(e)&&(r=o.clone(e),u(r)),r};var d=function(e){if((0,i.isObject)(e)&&null!==e){var t=(0,i.keysOf)(e);if(t.length<=2&&t.every((function(e){return"string"==typeof e&&"$"===e.substr(0,1)})))for(var r=0;r<c.length;r++){var s=c[r];if(s.matchJSONValue(e))return s.fromJSONValue(e)}}return e},h=function e(t){if(null===t)return null;var r=d(t);return r!==t?r:(0,i.isObject)(t)?((0,i.keysOf)(t).forEach((function(r){var s=t[r];if((0,i.isObject)(s)){var n=d(s);if(s!==n)return void(t[r]=n);e(s)}})),t):t};o._adjustTypesFromJSONValue=h,o.fromJSONValue=function(e){var t=d(e);return t===e&&(0,i.isObject)(e)&&(t=o.clone(e),h(t)),t},o.stringify=(0,i.handleError)((function(e,t){var r=o.toJSONValue(e);return t&&(t.canonical||t.indent)?s(4)(r,t):JSON.stringify(r)})),o.parse=function(e){if("string"!=typeof e)throw new Error("EJSON.parse argument should be a string");return o.fromJSONValue(JSON.parse(e))},o.isBinary=function(e){return!!("undefined"!=typeof Uint8Array&&e instanceof Uint8Array||e&&e.$Uint8ArrayPolyfill)},o.equals=function(e,t,r){var s,n=!(!r||!r.keyOrderSensitive);if(e===t)return!0;if(Number.isNaN(e)&&Number.isNaN(t))return!0;if(!e||!t)return!1;if(!(0,i.isObject)(e)||!(0,i.isObject)(t))return!1;if(e instanceof Date&&t instanceof Date)return e.valueOf()===t.valueOf();if(o.isBinary(e)&&o.isBinary(t)){if(e.length!==t.length)return!1;for(s=0;s<e.length;s++)if(e[s]!==t[s])return!1;return!0}if((0,i.isFunction)(e.equals))return e.equals(t,r);if((0,i.isFunction)(t.equals))return t.equals(e,r);var a,c=Array.isArray(e),l=Array.isArray(t);if(c!==l)return!1;if(c&&l){if(e.length!==t.length)return!1;for(s=0;s<e.length;s++)if(!o.equals(e[s],t[s],r))return!1;return!0}switch(o._isCustomType(e)+o._isCustomType(t)){case 1:return!1;case 2:return o.equals(o.toJSONValue(e),o.toJSONValue(t))}var u=(0,i.keysOf)(e),d=(0,i.keysOf)(t);return n?(s=0,a=u.every((function(n){return!(s>=d.length||n!==d[s]||!o.equals(e[n],t[d[s]],r)||(s++,0))}))):(s=0,a=u.every((function(n){return!!(0,i.hasOwn)(t,n)&&!!o.equals(e[n],t[n],r)&&(s++,!0)}))),a&&s===d.length},o.clone=function(e){var t;if(!(0,i.isObject)(e))return e;if(null===e)return null;if(e instanceof Date)return new Date(e.getTime());if(e instanceof RegExp)return e;if(o.isBinary(e)){t=o.newBinary(e.length);for(var r=0;r<e.length;r++)t[r]=e[r];return t}return Array.isArray(e)?e.map(o.clone):(0,i.isArguments)(e)?Array.from(e).map(o.clone):(0,i.isFunction)(e.clone)?e.clone():o._isCustomType(e)?o.fromJSONValue(o.clone(o.toJSONValue(e)),!0):(t={},(0,i.keysOf)(e).forEach((function(r){t[r]=o.clone(e[r])})),t)},o.newBinary=t.newBinary}(),e.exports=n.EJSON}()},228:e=>{"use strict";var t=Object.prototype.hasOwnProperty,r="~";function s(){}function n(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function i(e,t,s,i,o){if("function"!=typeof s)throw new TypeError("The listener must be a function");var a=new n(s,i||e,o),c=r?r+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],a]:e._events[c].push(a):(e._events[c]=a,e._eventsCount++),e}function o(e,t){0==--e._eventsCount?e._events=new s:delete e._events[t]}function a(){this._events=new s,this._eventsCount=0}Object.create&&(s.prototype=Object.create(null),(new s).__proto__||(r=!1)),a.prototype.eventNames=function(){var e,s,n=[];if(0===this._eventsCount)return n;for(s in e=this._events)t.call(e,s)&&n.push(r?s.slice(1):s);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},a.prototype.listeners=function(e){var t=r?r+e:e,s=this._events[t];if(!s)return[];if(s.fn)return[s.fn];for(var n=0,i=s.length,o=new Array(i);n<i;n++)o[n]=s[n].fn;return o},a.prototype.listenerCount=function(e){var t=r?r+e:e,s=this._events[t];return s?s.fn?1:s.length:0},a.prototype.emit=function(e,t,s,n,i,o){var a=r?r+e:e;if(!this._events[a])return!1;var c,l,u=this._events[a],d=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),d){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,s),!0;case 4:return u.fn.call(u.context,t,s,n),!0;case 5:return u.fn.call(u.context,t,s,n,i),!0;case 6:return u.fn.call(u.context,t,s,n,i,o),!0}for(l=1,c=new Array(d-1);l<d;l++)c[l-1]=arguments[l];u.fn.apply(u.context,c)}else{var h,p=u.length;for(l=0;l<p;l++)switch(u[l].once&&this.removeListener(e,u[l].fn,void 0,!0),d){case 1:u[l].fn.call(u[l].context);break;case 2:u[l].fn.call(u[l].context,t);break;case 3:u[l].fn.call(u[l].context,t,s);break;case 4:u[l].fn.call(u[l].context,t,s,n);break;default:if(!c)for(h=1,c=new Array(d-1);h<d;h++)c[h-1]=arguments[h];u[l].fn.apply(u[l].context,c)}}return!0},a.prototype.on=function(e,t,r){return i(this,e,t,r,!1)},a.prototype.once=function(e,t,r){return i(this,e,t,r,!0)},a.prototype.removeListener=function(e,t,s,n){var i=r?r+e:e;if(!this._events[i])return this;if(!t)return o(this,i),this;var a=this._events[i];if(a.fn)a.fn!==t||n&&!a.once||s&&a.context!==s||o(this,i);else{for(var c=0,l=[],u=a.length;c<u;c++)(a[c].fn!==t||n&&!a[c].once||s&&a[c].context!==s)&&l.push(a[c]);l.length?this._events[i]=1===l.length?l[0]:l:o(this,i)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&o(this,t)):(this._events=new s,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=r,a.EventEmitter=a,e.exports=a},2017:e=>{"use strict";e.exports=function e(t,r){if(t===r)return!0;if(t&&r&&"object"==typeof t&&"object"==typeof r){if(t.constructor!==r.constructor)return!1;var s,n,i;if(Array.isArray(t)){if((s=t.length)!=r.length)return!1;for(n=s;0!=n--;)if(!e(t[n],r[n]))return!1;return!0}if(t.constructor===RegExp)return t.source===r.source&&t.flags===r.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===r.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===r.toString();if((s=(i=Object.keys(t)).length)!==Object.keys(r).length)return!1;for(n=s;0!=n--;)if(!Object.prototype.hasOwnProperty.call(r,i[n]))return!1;for(n=s;0!=n--;){var o=i[n];if(!e(t[o],r[o]))return!1}return!0}return t!=t&&r!=r}},4865:e=>{"use strict";const t=(e,t,s,n)=>{if("length"===s||"prototype"===s)return;if("arguments"===s||"caller"===s)return;const i=Object.getOwnPropertyDescriptor(e,s),o=Object.getOwnPropertyDescriptor(t,s);!r(i,o)&&n||Object.defineProperty(e,s,o)},r=function(e,t){return void 0===e||e.configurable||e.writable===t.writable&&e.enumerable===t.enumerable&&e.configurable===t.configurable&&(e.writable||e.value===t.value)},s=(e,t)=>`/* Wrapped ${e}*/\n${t}`,n=Object.getOwnPropertyDescriptor(Function.prototype,"toString"),i=Object.getOwnPropertyDescriptor(Function.prototype.toString,"name");e.exports=(e,r,{ignoreNonConfigurable:o=!1}={})=>{const{name:a}=e;for(const s of Reflect.ownKeys(r))t(e,r,s,o);return((e,t)=>{const r=Object.getPrototypeOf(t);r!==Object.getPrototypeOf(e)&&Object.setPrototypeOf(e,r)})(e,r),((e,t,r)=>{const o=""===r?"":`with ${r.trim()}() `,a=s.bind(null,o,t.toString());Object.defineProperty(a,"name",i),Object.defineProperty(e,"toString",{...n,value:a})})(e,r,a),e}},4617:e=>{"use strict";e.exports=(e,t)=>(t=t||(()=>{}),e.then((e=>new Promise((e=>{e(t())})).then((()=>e))),(e=>new Promise((e=>{e(t())})).then((()=>{throw e})))))},3290:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(6368),n=r(7685),i=r(4774),o=()=>{},a=new n.TimeoutError;t.default=class extends s{constructor(e){var t,r,s,n;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=o,this._resolveIdle=o,!("number"==typeof(e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:i.default},e)).intervalCap&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${null!==(r=null===(t=e.intervalCap)||void 0===t?void 0:t.toString())&&void 0!==r?r:""}\` (${typeof e.intervalCap})`);if(void 0===e.interval||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${null!==(n=null===(s=e.interval)||void 0===s?void 0:s.toString())&&void 0!==n?n:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||0===e.interval,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=!0===e.throwOnTimeout,this._isPaused=!1===e.autoStart}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=o,0===this._pendingCount&&(this._resolveIdle(),this._resolveIdle=o,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const e=Date.now();if(void 0===this._intervalId){const t=this._intervalEnd-e;if(!(t<0))return void 0===this._timeoutId&&(this._timeoutId=setTimeout((()=>{this._onResumeInterval()}),t)),!0;this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0}return!1}_tryToStartAnother(){if(0===this._queue.size)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const t=this._queue.dequeue();return!!t&&(this.emit("active"),t(),e&&this._initializeIntervalIfNeeded(),!0)}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||void 0!==this._intervalId||(this._intervalId=setInterval((()=>{this._onInterval()}),this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){0===this._intervalCount&&0===this._pendingCount&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!("number"==typeof e&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,t={}){return new Promise(((r,s)=>{this._queue.enqueue((async()=>{this._pendingCount++,this._intervalCount++;try{const i=void 0===this._timeout&&void 0===t.timeout?e():n.default(Promise.resolve(e()),void 0===t.timeout?this._timeout:t.timeout,(()=>{(void 0===t.throwOnTimeout?this._throwOnTimeout:t.throwOnTimeout)&&s(a)}));r(await i)}catch(e){s(e)}this._next()}),t),this._tryToStartAnother(),this.emit("add")}))}async addAll(e,t){return Promise.all(e.map((async e=>this.add(e,t))))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(0!==this._queue.size)return new Promise((e=>{const t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}}))}async onIdle(){if(0!==this._pendingCount||0!==this._queue.size)return new Promise((e=>{const t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}}))}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}}},9998:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r){let s=0,n=e.length;for(;n>0;){const i=n/2|0;let o=s+i;r(e[o],t)<=0?(s=++o,n-=i+1):n=i}return s}},4774:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(9998);t.default=class{constructor(){this._queue=[]}enqueue(e,t){const r={priority:(t=Object.assign({priority:0},t)).priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority)return void this._queue.push(r);const n=s.default(this._queue,r,((e,t)=>t.priority-e.priority));this._queue.splice(n,0,r)}dequeue(){const e=this._queue.shift();return null==e?void 0:e.run}filter(e){return this._queue.filter((t=>t.priority===e.priority)).map((e=>e.run))}get size(){return this._queue.length}}},6368:e=>{"use strict";var t=Object.prototype.hasOwnProperty,r="~";function s(){}function n(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function i(e,t,s,i,o){if("function"!=typeof s)throw new TypeError("The listener must be a function");var a=new n(s,i||e,o),c=r?r+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],a]:e._events[c].push(a):(e._events[c]=a,e._eventsCount++),e}function o(e,t){0==--e._eventsCount?e._events=new s:delete e._events[t]}function a(){this._events=new s,this._eventsCount=0}Object.create&&(s.prototype=Object.create(null),(new s).__proto__||(r=!1)),a.prototype.eventNames=function(){var e,s,n=[];if(0===this._eventsCount)return n;for(s in e=this._events)t.call(e,s)&&n.push(r?s.slice(1):s);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},a.prototype.listeners=function(e){var t=r?r+e:e,s=this._events[t];if(!s)return[];if(s.fn)return[s.fn];for(var n=0,i=s.length,o=new Array(i);n<i;n++)o[n]=s[n].fn;return o},a.prototype.listenerCount=function(e){var t=r?r+e:e,s=this._events[t];return s?s.fn?1:s.length:0},a.prototype.emit=function(e,t,s,n,i,o){var a=r?r+e:e;if(!this._events[a])return!1;var c,l,u=this._events[a],d=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),d){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,s),!0;case 4:return u.fn.call(u.context,t,s,n),!0;case 5:return u.fn.call(u.context,t,s,n,i),!0;case 6:return u.fn.call(u.context,t,s,n,i,o),!0}for(l=1,c=new Array(d-1);l<d;l++)c[l-1]=arguments[l];u.fn.apply(u.context,c)}else{var h,p=u.length;for(l=0;l<p;l++)switch(u[l].once&&this.removeListener(e,u[l].fn,void 0,!0),d){case 1:u[l].fn.call(u[l].context);break;case 2:u[l].fn.call(u[l].context,t);break;case 3:u[l].fn.call(u[l].context,t,s);break;case 4:u[l].fn.call(u[l].context,t,s,n);break;default:if(!c)for(h=1,c=new Array(d-1);h<d;h++)c[h-1]=arguments[h];u[l].fn.apply(u[l].context,c)}}return!0},a.prototype.on=function(e,t,r){return i(this,e,t,r,!1)},a.prototype.once=function(e,t,r){return i(this,e,t,r,!0)},a.prototype.removeListener=function(e,t,s,n){var i=r?r+e:e;if(!this._events[i])return this;if(!t)return o(this,i),this;var a=this._events[i];if(a.fn)a.fn!==t||n&&!a.once||s&&a.context!==s||o(this,i);else{for(var c=0,l=[],u=a.length;c<u;c++)(a[c].fn!==t||n&&!a[c].once||s&&a[c].context!==s)&&l.push(a[c]);l.length?this._events[i]=1===l.length?l[0]:l:o(this,i)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&o(this,t)):(this._events=new s,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=r,a.EventEmitter=a,e.exports=a},7685:(e,t,r)=>{"use strict";const s=r(4617);class n extends Error{constructor(e){super(e),this.name="TimeoutError"}}const i=(e,t,r)=>new Promise(((i,o)=>{if("number"!=typeof t||t<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(t===1/0)return void i(e);const a=setTimeout((()=>{if("function"==typeof r){try{i(r())}catch(e){o(e)}return}const s=r instanceof Error?r:new n("string"==typeof r?r:`Promise timed out after ${t} milliseconds`);"function"==typeof e.cancel&&e.cancel(),o(s)}),t);s(e.then(i,o),(()=>{clearTimeout(a)}))}));e.exports=i,e.exports.default=i,e.exports.TimeoutError=n},7194:e=>{"use strict";e.exports=require("dgram")},1943:e=>{"use strict";e.exports=require("fs/promises")},9278:e=>{"use strict";e.exports=require("net")},6928:e=>{"use strict";e.exports=require("path")},2203:e=>{"use strict";e.exports=require("stream")},4581:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},4326:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.runEntrypoint=function(e,t){Promise.resolve().then((async()=>{if(u)throw new Error("runEntrypoint can only be called once");if(u=!0,t||(t=[]),!Array.isArray(t))throw new Error("upgradeScripts must be an array");for(const e of t)if("function"!=typeof e)throw new Error("upgradeScripts must be an array of functions");const r=process.env.MODULE_MANIFEST;if(!r)throw new Error("Module initialise is missing MODULE_MANIFEST");const s=await i.default.readFile(r),d=JSON.parse(s.toString());if(d.runtime?.api!==n.HostApiNodeJsIpc)throw new Error("Module manifest 'api' mismatch");if(!d.runtime.apiVersion)throw new Error("Module manifest 'apiVersion' missing");let h=d.runtime.apiVersion;if("0.0.0"===h)try{const e=await i.default.readFile(c.default.join(__dirname,"../package.json")),t=JSON.parse(e.toString());"@companion-module/base"===t.name&&(h=t.version)}catch(e){throw new Error("Failed to determine module api version")}if(!process.send)throw new Error("Module is not being run with ipc");console.log(`Starting up module class: ${e.name}`);const p=process.env.CONNECTION_ID;if("string"!=typeof p||!p)throw new Error("Module initialise is missing CONNECTION_ID");const f=process.env.VERIFICATION_TOKEN;if("string"!=typeof f||!f)throw new Error("Module initialise is missing VERIFICATION_TOKEN");const b=new a.IpcWrapper({},(e=>{process.send(e)}),5e3);process.once("message",(e=>{b.receivedMessage(e)})),l=new e((0,o.literal)({id:p,upgradeScripts:t,_isInstanceBaseProps:!0})),b.sendWithCb("register",{apiVersion:h,connectionId:p,verificationToken:f}).then((()=>{console.log("Module-host accepted registration")}),(e=>{console.error("Module registration failed",e),process.exit(11)}))})).catch((e=>{console.error("Failed to startup module:"),console.error(e.stack||e.message),process.exit(1)}))};const s=r(1635),n=r(9967),i=s.__importDefault(r(1943)),o=r(360),a=r(4044),c=s.__importDefault(r(6928));let l,u=!1},6160:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UDPHelper=t.TelnetHelper=t.TCPHelper=void 0;var s=r(8895);Object.defineProperty(t,"TCPHelper",{enumerable:!0,get:function(){return s.TCPHelper}});var n=r(1118);Object.defineProperty(t,"TelnetHelper",{enumerable:!0,get:function(){return n.TelnetHelper}});var i=r(6259);Object.defineProperty(t,"UDPHelper",{enumerable:!0,get:function(){return i.UDPHelper}})},8895:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TCPHelper=void 0;const s=r(1635).__importDefault(r(9278)),n=r(228),i=r(1400);class o extends n.EventEmitter{#e;#t;_socket;#r;#s=!1;#n=!1;#i=!1;#o;#a;#c;get isConnected(){return this.#s}get isConnecting(){return this.#n}get isDestroyed(){return this.#i}constructor(e,t,r){super(),this.#e=e,this.#t=t,this.#r={reconnect_interval:2e3,reconnect:!0,...r},this._socket=new s.default.Socket,this._socket.setKeepAlive(!0),this._socket.setNoDelay(!0),this._socket.on("error",(e=>{this.#n=!1,this.#s=!1,this.#r.reconnect&&this.#l(),this.#u(i.InstanceStatus.UnknownError,e.message),this.emit("error",e)})),this._socket.on("ready",(()=>{this.#s=!0,this.#n=!1,this.#u(i.InstanceStatus.Ok),this.emit("connect")})),this._socket.on("end",(()=>{this.#s=!1,this.#u(i.InstanceStatus.Disconnected),!this.#n&&this.#r.reconnect&&this.#l(),this.emit("end")})),this._socket.on("data",(e=>this.emit("data",e))),this._socket.on("drain",(()=>this.emit("drain"))),setImmediate((()=>{this.#i||this.connect()})),this.#c=setTimeout((()=>{this.#c=void 0,this.#i||this.listenerCount("error")||console.error(`Danger: TCP client for ${this.#e}:${this.#t} is missing an error handler!`)}),5e3)}connect(){if(this.#i)throw new Error("Cannot connect destroyed socket");return!this.#n&&(this.#n=!0,this._socket.connect(this.#t,this.#e),!0)}async send(e){if(this.#i||this._socket.destroyed)throw new Error("Cannot write to destroyed socket");if(!e||!e.length)throw new Error("No message to send");if(!this.#s)return!1;try{return new Promise(((t,r)=>{this._socket.write(e,(e=>{e?r(e):t(!0)}))}))}catch(e){this.#s=!1;const t=e instanceof Error?e:new Error(`${e}`);throw this.#u(i.InstanceStatus.UnknownError,t.message),this.emit("error",t),t}}destroy(){this.#i=!0,void 0!==this.#a&&(clearTimeout(this.#a),this.#a=void 0),void 0!==this.#c&&(clearTimeout(this.#c),this.#c=void 0),this._socket.removeAllListeners(),this.removeAllListeners(),this._socket.destroy()}#l(){void 0!==this.#a&&clearTimeout(this.#a),this.#a=setTimeout((()=>{this.#a=void 0,this.#u(i.InstanceStatus.Connecting),this.connect()}),this.#r.reconnect_interval)}#u(e,t){this.#o!=e&&(this.#o=e,this.emit("status_change",e,t))}}t.TCPHelper=o},1118:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TelnetHelper=void 0;const s=r(1635).__importDefault(r(228)),n=r(2203),i=r(8895);class o extends s.default{#d;#h;#c;get isConnected(){return this.#d.isConnected}get isConnecting(){return this.#d.isConnecting}get isDestroyed(){return this.#d.isDestroyed}constructor(e,t,r){super(),this.#d=new i.TCPHelper(e,t,r),this.#h=new a,this.#d._socket.pipe(this.#h),this.#d.on("connect",(()=>this.emit("connect"))),this.#d.on("end",(()=>this.emit("end"))),this.#d.on("error",(e=>this.emit("error",e))),this.#d.on("status_change",((e,t)=>this.emit("status_change",e,t))),this.#h.on("iac",((e,t)=>this.emit("iac",e,t))),this.#h.on("sb",(e=>this.emit("sb",e))),this.#h.on("data",(e=>this.emit("data",e))),this.#h.on("drain",(()=>this.emit("drain"))),this.#c=setTimeout((()=>{this.#c=void 0,this.isDestroyed||this.listenerCount("error")||console.error(`Danger: Telnet client for ${e}:${t} is missing an error handler!`)}),5e3)}connect(){return this.#d.connect()}async send(e){return this.#d.send(e)}destroy(){this.#d.destroy(),void 0!==this.#c&&(clearTimeout(this.#c),this.#c=void 0),this.#h.removeAllListeners(),this.#h.destroy()}}t.TelnetHelper=o;class a extends n.Transform{#p;#f;#b;constructor(e){super(e),this.#p=Buffer.alloc(0),this.#f=Buffer.alloc(0),this.#b=0}_transform(e,t,r){for(let t=0;t<e.length;++t)this.#g(e[t]);const s=this.#y();s.length&&this.push(s),r()}#g(e){if(0===this.#b){if(255===e)return void(this.#b=255);this.#p=Buffer.concat([this.#p,Buffer.from([e])])}else if(255===this.#b)switch(e){case 250:case 251:case 252:case 253:case 254:this.#b=e;break;default:this.#b=0}else{if(this.#b>=251&&this.#b<=254){let t;switch(this.#b){case 251:t="WILL";break;case 252:t="WONT";break;case 253:t="DO";break;case 254:t="DONT";break;default:return}return this.emit("iac",t,e),void(this.#b=0)}if(250===this.#b){if(240===e)return this.emit("sb",this.#f),this.#b=0,void(this.#f=Buffer.alloc(0));this.#f=Buffer.concat([this.#f,Buffer.from([e])])}}}#y(){const e=this.#p;return this.#p=Buffer.alloc(0),e}}},6259:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UDPHelper=void 0;const s=r(1635).__importDefault(r(7194)),n=r(228),i=r(1400);class o extends n.EventEmitter{#e;#t;#m;#r;#i=!1;#o;#c;get isDestroyed(){return this.#i}constructor(e,t,r){super(),this.#e=e,this.#t=t,this.#r={...r},this.#m=s.default.createSocket("udp4");try{this.#m.bind(this.#r.bind_port||0,this.#r.bind_ip)}catch(e){throw new Error(`Unable to bind to ip/port: ${this.#r.bind_ip||"0.0.0.0"}:${this.#r.bind_port||0}`)}void 0!==this.#r.ttl&&this.#m.setTTL(this.#r.ttl),void 0!==this.#r.multicast_ttl&&this.#m.setMulticastTTL(this.#r.multicast_ttl),this.#m.on("error",(e=>{this.#u(i.InstanceStatus.UnknownError,e.message),this.emit("error",e)})),this.#m.on("listening",(()=>{this.#r.broadcast&&this.#m.setBroadcast(!0),this.#r.multicast_interface&&this.#m.setMulticastInterface(this.#r.multicast_interface),this.#u(i.InstanceStatus.Ok),this.emit("listening")})),this.#m.on("message",((e,t)=>this.emit("data",e,t))),this.#c=setTimeout((()=>{this.#i||this.listenerCount("error")||console.error(`Danger: UDP socket for ${this.#e}:${this.#t} is missing an error handler!`)}),5e3)}async send(e){if(this.#i)throw new Error("Cannot write to destroyed socket");if(!e||!e.length)throw new Error("No message to send");return new Promise(((t,r)=>{this.#m.send(e,this.#t,this.#e,(e=>{e?r(e):t()}))}))}destroy(){this.#i=!0,void 0!==this.#c&&(clearTimeout(this.#c),this.#c=void 0),this.#m.removeAllListeners(),this.#m.close(),this.removeAllListeners()}#u(e,t){this.#o!=e&&(this.#o=e,this.emit("status_change",e,t))}}t.UDPHelper=o},4044:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IpcWrapper=void 0;const s=r(1635),n=r(360),i=s.__importDefault(r(6022));t.IpcWrapper=class{#_;#v;#I;#T=1;#E=new Map;constructor(e,t,r){this.#_=e,this.#v=t,this.#I=r}async sendWithCb(e,t,r,s=0){s<=0&&(s=this.#I);const n={timeout:void 0,resolve:()=>null,reject:()=>null},o=new Promise(((e,t)=>{n.resolve=e,n.reject=t}));this.#T>268435456&&(this.#T=1);const a=this.#T++;this.#E.set(a,n),this.#v({direction:"call",name:String(e),payload:i.default.stringify(t),callbackId:a});const c=new Error("Call timed out");return n.timeout=setTimeout((()=>{n.reject(r?r():c),this.#E.delete(a)}),s),o}sendWithNoCb(e,t){this.#v({direction:"call",name:String(e),payload:i.default.stringify(t),callbackId:void 0})}receivedMessage(e){const t=e;switch(e.direction){case"call":{const t=this.#_[e.name];if(!t)return void(e.callbackId&&this.#v({direction:"response",callbackId:e.callbackId,success:!1,payload:i.default.stringify({message:`Unknown command "${e.name}"`})}));t(e.payload?i.default.parse(e.payload):void 0).then((t=>{e.callbackId&&this.#v({direction:"response",callbackId:e.callbackId,success:!0,payload:i.default.stringify(t)})}),(t=>{e.callbackId&&this.#v({direction:"response",callbackId:e.callbackId,success:!1,payload:t instanceof Error?JSON.stringify(t,Object.getOwnPropertyNames(t)):i.default.stringify(t)})}));break}case"response":{if(!e.callbackId)return void console.error("Ipc: Response message has no callbackId");const t=this.#E.get(e.callbackId);if(this.#E.delete(e.callbackId),!t)return;clearTimeout(t.timeout);const r=e.payload?i.default.parse(e.payload):void 0;if(e.success)t.resolve(r);else{let e=r;r&&"object"==typeof r&&"message"in r&&(e=new Error(r.message),r.stack&&(e.stack=r.stack)),t.reject(e)}break}default:(0,n.assertNever)(e),console.error(`Ipc: Message of unknown direction "${t.direction}"`)}}}},9967:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HostApiNodeJsIpc=void 0,t.HostApiNodeJsIpc="nodejs-ipc"},6278:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.runEntrypoint=t.substituteEscapeCharacters=t.parseEscapeCharacters=t.assertNever=t.splitHex=t.splitHsv=t.splitHsl=t.splitRgb=t.combineRgb=t.literal=void 0;const s=r(1635);s.__exportStar(r(9077),t),s.__exportStar(r(2018),t),s.__exportStar(r(4581),t);var n=r(360);Object.defineProperty(t,"literal",{enumerable:!0,get:function(){return n.literal}}),Object.defineProperty(t,"combineRgb",{enumerable:!0,get:function(){return n.combineRgb}}),Object.defineProperty(t,"splitRgb",{enumerable:!0,get:function(){return n.splitRgb}}),Object.defineProperty(t,"splitHsl",{enumerable:!0,get:function(){return n.splitHsl}}),Object.defineProperty(t,"splitHsv",{enumerable:!0,get:function(){return n.splitHsv}}),Object.defineProperty(t,"splitHex",{enumerable:!0,get:function(){return n.splitHex}}),Object.defineProperty(t,"assertNever",{enumerable:!0,get:function(){return n.assertNever}}),Object.defineProperty(t,"parseEscapeCharacters",{enumerable:!0,get:function(){return n.parseEscapeCharacters}}),Object.defineProperty(t,"substituteEscapeCharacters",{enumerable:!0,get:function(){return n.substituteEscapeCharacters}}),s.__exportStar(r(6160),t);var i=r(4326);Object.defineProperty(t,"runEntrypoint",{enumerable:!0,get:function(){return i.runEntrypoint}})},4289:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ActionManager=void 0;const s=r(2593);function n(e){return{id:e.id,actionId:e.actionId,controlId:e.controlId,options:e.options}}t.ActionManager=class{#A;#S;#k;#w;#L=new Map;#O=new Map;constructor(e,t,r,s){this.#A=e,this.#S=t,this.#k=r,this.#w=s}async handleExecuteAction(e){const t=this.#L.get(e.action.actionId);if(!t)throw new Error(`Unknown action: ${e.action.actionId}`);const r={parseVariablesInString:async t=>(await this.#A({text:t,controlId:e.action.controlId,actionInstanceId:e.action.id,feedbackInstanceId:void 0})).text,setCustomVariableValue:(t,r)=>{this.#k({customVariableId:t,value:r,controlId:e.action.controlId})}};await t.callback({id:e.action.id,actionId:e.action.actionId,controlId:e.action.controlId,options:e.action.options,surfaceId:e.surfaceId},r)}handleUpdateActions(e){for(const[t,r]of Object.entries(e)){const e=this.#O.get(t);if(e){const t=this.#L.get(e.actionId);if(t?.unsubscribe){const r={parseVariablesInString:async t=>(await this.#A({text:t,controlId:e.controlId,actionInstanceId:e.id,feedbackInstanceId:void 0})).text,setCustomVariableValue:()=>{throw new Error("setCustomVariableValue is not available during unsubscribe")}};Promise.resolve(t.unsubscribe(n(e),r)).catch((t=>{this.#w("error",`Action unsubscribe failed: ${JSON.stringify(e)} - ${t?.message??t} ${t?.stack}`)}))}}if(!r||r.disabled)this.#O.delete(t);else{this.#O.set(t,r);const e=this.#L.get(r.actionId);if(e?.subscribe){const t={parseVariablesInString:async e=>(await this.#A({text:e,controlId:r.controlId,actionInstanceId:r.id,feedbackInstanceId:void 0})).text,setCustomVariableValue:()=>{throw new Error("setCustomVariableValue is not available during unsubscribe")}};Promise.resolve(e.subscribe(n(r),t)).catch((e=>{this.#w("error",`Action subscribe failed: ${JSON.stringify(r)} - ${e?.message??e} ${e?.stack}`)}))}}}}async handleLearnAction(e){const t=this.#L.get(e.action.actionId);if(t&&t.learn){const r={parseVariablesInString:async t=>(await this.#A({text:t,controlId:e.action.controlId,actionInstanceId:e.action.id,feedbackInstanceId:void 0})).text,setCustomVariableValue:()=>{throw new Error("setCustomVariableValue is not available during learn")}};return{options:await t.learn({id:e.action.id,actionId:e.action.actionId,controlId:e.action.controlId,options:e.action.options,surfaceId:void 0},r)}}return{options:void 0}}setActionDefinitions(e){const t=[];this.#L.clear();for(const[r,n]of Object.entries(e))n&&(t.push({id:r,name:n.name,description:n.description,options:(0,s.serializeIsVisibleFn)(n.options),hasLearn:!!n.learn,learnTimeout:n.learnTimeout,hasLifecycleFunctions:!!n.subscribe||!!n.unsubscribe}),this.#L.set(r,n));this.#S({actions:t})}subscribeActions(e){let t=Array.from(this.#O.values());const r=new Set(e);r.size&&(t=t.filter((e=>r.has(e.actionId))));for(const e of t){const t=this.#L.get(e.actionId);if(t?.subscribe){const r={parseVariablesInString:async t=>(await this.#A({text:t,controlId:e.controlId,actionInstanceId:e.id,feedbackInstanceId:void 0})).text,setCustomVariableValue:()=>{throw new Error("setCustomVariableValue is not available during subscribe")}};Promise.resolve(t.subscribe(n(e),r)).catch((t=>{this.#w("error",`Action subscribe failed: ${JSON.stringify(e)} - ${t?.message??t} ${t?.stack}`)}))}}}unsubscribeActions(e){let t=Array.from(this.#O.values());const r=new Set(e);r.size&&(t=t.filter((e=>r.has(e.actionId))));for(const e of t){const t=this.#L.get(e.actionId);if(t&&t.unsubscribe){const r={parseVariablesInString:async t=>(await this.#A({text:t,controlId:e.controlId,actionInstanceId:e.id,feedbackInstanceId:void 0})).text,setCustomVariableValue:()=>{throw new Error("setCustomVariableValue is not available during unsubscribe")}};Promise.resolve(t.unsubscribe(n(e),r)).catch((t=>{this.#w("error",`Action unsubscribe failed: ${JSON.stringify(e)} - ${t?.message??t} ${t?.stack}`)}))}}}}},2593:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.serializeIsVisibleFn=function(e){return(e??[]).map((e=>"isVisibleExpression"in e&&"string"==typeof e.isVisibleExpression?{...e,isVisibleFnType:"expression",isVisibleFn:e.isVisibleExpression,isVisible:void 0,isVisibleExpression:void 0}:"isVisible"in e&&"function"==typeof e.isVisible?{...e,isVisibleFn:e.isVisible.toString(),isVisibleFnType:"function",isVisible:void 0,isVisibleExpression:void 0}:{...e,isVisible:void 0,isVisibleFn:void 0,isVisibleFnType:void 0,isVisibleExpression:void 0}))},t.isInstanceBaseProps=function(e){const t=e;return"object"==typeof t&&"string"==typeof t.id&&!0===t._isInstanceBaseProps}},8039:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FeedbackManager=void 0;const s=r(1635),n=r(2593),i=s.__importDefault(r(7e3));function o(e,t){return{type:e,id:t.id,feedbackId:t.feedbackId,controlId:t.controlId,options:t.options}}t.FeedbackManager=class{#A;#P;#N;#w;#R=new Map;#C=new Map;#j=new Map;#x=new Map;#M;get parseVariablesContext(){return this.#M}constructor(e,t,r,s){this.#A=e,this.#P=t,this.#N=r,this.#w=s}getDefinitionIds(){return Array.from(this.#R.keys())}getInstanceIds(){return Array.from(this.#C.keys())}handleUpdateFeedbacks(e){for(const[t,r]of Object.entries(e)){const e=this.#C.get(t);if(e){const t=this.#R.get(e.feedbackId);if(t?.unsubscribe){const r={parseVariablesInString:async t=>(await this.#A({text:t,controlId:e.controlId,actionInstanceId:void 0,feedbackInstanceId:e.id})).text};Promise.resolve(t.unsubscribe(o(t.type,e),r)).catch((t=>{this.#w("error",`Feedback unsubscribe failed: ${JSON.stringify(e)} - ${t?.message??t} ${t?.stack}`)}))}}if(!r||r.disabled)this.#C.delete(t);else{this.#C.set(t,{...r,referencedVariables:null});const e=this.#R.get(r.feedbackId);if(e?.subscribe){const t={parseVariablesInString:async e=>(await this.#A({text:e,controlId:r.controlId,actionInstanceId:void 0,feedbackInstanceId:r.id})).text};Promise.resolve(e.subscribe(o(e.type,r),t)).catch((e=>{this.#w("error",`Feedback subscribe failed: ${JSON.stringify(r)} - ${e?.message??e} ${e?.stack}`)}))}this.#D(t)}}}async handleLearnFeedback(e){const t=this.#R.get(e.feedback.feedbackId);if(t&&t.learn){const r={parseVariablesInString:async t=>(await this.#A({text:t,controlId:e.feedback.controlId,actionInstanceId:void 0,feedbackInstanceId:e.feedback.id})).text};return{options:await t.learn({id:e.feedback.id,feedbackId:e.feedback.feedbackId,controlId:e.feedback.controlId,options:e.feedback.options,type:t.type},r)}}return{options:void 0}}handleVariablesChanged(e){if(!e.variablesIds.length)return;const t=new Set(e.variablesIds);for(const t of this.#x.values())for(const r of e.variablesIds)t.changedVariables.add(r);const r=new Set;for(const e of this.#C.values())if(!this.#x.has(e.id)&&e.referencedVariables)for(const s of e.referencedVariables)if(t.has(s)){r.add(e.id);break}for(const e of r)setImmediate((()=>{this.#D(e)}))}#D(e){const t=this.#x.get(e);if(t)return void(t.needsRecheck=!0);const r=this.#C.get(e);if(!r)return;const s=r,n={needsRecheck:!1,changedVariables:new Set};this.#x.set(e,n),Promise.resolve().then((async()=>{const t=this.#R.get(s.feedbackId);let r;const n=new Set;if(t){this.#M=`Feedback ${s.feedbackId} (${e})`;const i={parseVariablesInString:async t=>{const r=await this.#A({text:t,controlId:s.controlId,actionInstanceId:void 0,feedbackInstanceId:e});if(r.variableIds&&r.variableIds.length)for(const e of r.variableIds)n.add(e);return r.text}};r="boolean"===t.type?t.callback({...o("boolean",s),type:"boolean"},i):t.callback({...o("advanced",s),type:"advanced",image:s.image},i),this.#M=void 0}const i=await r;this.#j.set(e,{id:e,controlId:s.controlId,value:i}),this.#V(),s.referencedVariables=n.size>0?Array.from(n):null})).catch((e=>{console.error(`Feedback check failed: ${JSON.stringify(s)} - ${e?.message??e} ${e?.stack}`)})).finally((()=>{this.#M=void 0,this.#x.delete(e);let t=!1;if(s.referencedVariables)for(const e of s.referencedVariables)if(n.changedVariables.has(e)){t=!0;break}(t||n.needsRecheck)&&setImmediate((()=>{this.#D(e)}))}))}#V=(0,i.default)((()=>{const e=this.#j;this.#j=new Map,e.size>0&&this.#P({values:Array.from(e.values())})}),{wait:5,maxWait:25});setFeedbackDefinitions(e){const t=[];this.#R.clear();for(const[r,s]of Object.entries(e))s&&(t.push({id:r,name:s.name,description:s.description,options:(0,n.serializeIsVisibleFn)(s.options),type:s.type,defaultStyle:"boolean"===s.type?s.defaultStyle:void 0,hasLearn:!!s.learn,learnTimeout:s.learnTimeout,showInvert:"boolean"===s.type&&s.showInvert}),this.#R.set(r,s));this.#N({feedbacks:t})}checkFeedbacks(e){const t=new Set(e);for(const[e,r]of this.#C.entries())this.#R.get(r.feedbackId)&&(0===t.size||t.has(r.feedbackId))&&this.#D(e)}checkFeedbacksById(e){for(const t of e)this.#D(t)}subscribeFeedbacks(e){let t=Array.from(this.#C.values());const r=new Set(e);r.size&&(t=t.filter((e=>r.has(e.feedbackId))));for(const e of t){const t=this.#R.get(e.feedbackId);if(t?.subscribe){const r={parseVariablesInString:async t=>(await this.#A({text:t,controlId:e.controlId,actionInstanceId:void 0,feedbackInstanceId:e.id})).text};Promise.resolve(t.subscribe(o(t.type,e),r)).catch((t=>{this.#w("error",`Feedback subscribe failed: ${JSON.stringify(e)} - ${t?.message??t} ${t?.stack}`)}))}}}unsubscribeFeedbacks(e){let t=Array.from(this.#C.values());const r=new Set(e);r.size&&(t=t.filter((e=>r.has(e.feedbackId))));for(const e of t){const t=this.#R.get(e.feedbackId);if(t&&t.unsubscribe){const r={parseVariablesInString:async t=>(await this.#A({text:t,controlId:e.controlId,actionInstanceId:void 0,feedbackInstanceId:e.id})).text};Promise.resolve(t.unsubscribe(o(t.type,e),r)).catch((t=>{this.#w("error",`Feedback unsubscribe failed: ${JSON.stringify(e)} - ${t?.message??t} ${t?.stack}`)}))}}}}},1706:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.runThroughUpgradeScripts=function(e,t,r,i,o,a){const c=new Map,l=e=>{let t=c.get(e);return t||(t={actions:[],feedbacks:[],config:!1},c.set(e,t)),t};for(const t of Object.values(e)){const e=t?.upgradeIndex??r;t&&"number"==typeof e&&l(e).actions.push(t.id)}for(const e of Object.values(t)){const t=e?.upgradeIndex??r;e&&"number"==typeof t&&l(t).feedbacks.push(e.id)}if(!a)for(let e=r??-1;e<i.length;e++)l(e).config=!0;const u={},d={};let h;if(c.size>0){const a=Array.from(c.keys()).sort(),l=Math.min(...a,r??-1)+1,p=[],f=[],b=i.length;for(let r=l;r<b;r++){const a=c.get(r-1);a&&(p.push(...a.actions),f.push(...a.feedbacks));const l=!!a?.config;if(!l&&0===p.length&&0===f.length)continue;const b=h??o,g=(0,i[r])({currentConfig:n(b)},{config:l?b:null,actions:p.map((t=>{const r=e[t];if(r)return(0,s.literal)({id:r.id,controlId:r.controlId,actionId:r.actionId,options:void 0!==r.options?n(r.options):{}})})).filter((e=>!!e)),feedbacks:f.map((e=>{const r=t[e];if(r)return(0,s.literal)({id:r.id,controlId:r.controlId,feedbackId:r.feedbackId,options:void 0!==r.options?n(r.options):{},isInverted:r.isInverted})})).filter((e=>!!e))});l&&g.updatedConfig&&(h=g.updatedConfig);for(const t of g.updatedActions)if(t){const r=e[t.id];r&&(r.actionId=t.actionId,r.options=t.options,d[t.id]=r)}for(const e of g.updatedFeedbacks)if(e){const r=t[e.id];r&&(r.feedbackId=e.feedbackId,r.options=e.options,u[e.id]={...r,style:u[e.id]?.style??e.style,isInverted:e.isInverted??!1})}}for(const[t,r]of Object.entries(e))d[t]||"number"!=typeof r?.upgradeIndex||(d[t]=r);for(const[e,r]of Object.entries(t))u[e]||"number"!=typeof r?.upgradeIndex||(u[e]=r)}return{updatedActions:d,updatedFeedbacks:u,updatedConfig:h}};const s=r(360);function n(e){return JSON.parse(JSON.stringify(e))}},9077:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.validateManifest=function(e,t){if(!t){const t=JSON.stringify(e);if(t.includes("companion-module-your-module-name"))throw new Error("Manifest incorrectly references template module 'companion-module-your-module-name'");if(t.includes("module-shortname"))throw new Error("Manifest incorrectly references template module 'module-shortname'");if(t.includes("A short one line description of your module"))throw new Error("Manifest incorrectly references template module 'A short one line description of your module'");if(t.includes("Your name"))throw new Error("Manifest incorrectly references template module 'Your name'");if(t.includes("Your email"))throw new Error("Manifest incorrectly references template module 'Your email'");if(t.includes("Your company"))throw new Error("Manifest incorrectly references template module 'Your company'");if(t.includes("Your product"))throw new Error("Manifest incorrectly references template module 'Your product'")}if(e.legacyIds.includes(e.id))throw new Error(`Manifest contains itself '${e.id}' in legacyIds`);if(!(0,s.default)(e)){const e=s.default.errors;if(!e)throw new Error("Manifest failed validation with unknown reason");throw new Error(`Manifest validation failed: ${JSON.stringify(e)}`)}};const s=r(1635).__importDefault(r(7281))},3730:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},1649:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InstanceBase=void 0;const s=r(1635),n=r(360),i=s.__importDefault(r(3290)),o=r(2593),a=r(1706),c=r(8039),l=r(4044),u=r(4289),d=r(2365);t.InstanceBase=class{#$;#U;id;#F=new i.default({concurrency:1});#B=!1;#q=!1;#H={};#G;#J;#z=new Map;#W=new Map;#Q=new Map;#r;#K;get instanceOptions(){return this.#r}get label(){return this.#K}constructor(e){if(!(0,o.isInstanceBaseProps)(e)||!e._isInstanceBaseProps)throw new Error("Module instance is being constructed incorrectly. Make sure you aren't trying to do this manually");this.createSharedUdpSocket=this.createSharedUdpSocket.bind(this),this.#r={disableVariableValidation:!1},this.#$=new l.IpcWrapper({init:this._handleInit.bind(this),destroy:this._handleDestroy.bind(this),updateConfigAndLabel:this._handleConfigUpdateAndLabel.bind(this),updateConfig:async()=>{},executeAction:this._handleExecuteAction.bind(this),updateFeedbacks:this._handleUpdateFeedbacks.bind(this),updateActions:this._handleUpdateActions.bind(this),getConfigFields:this._handleGetConfigFields.bind(this),handleHttpRequest:this._handleHttpRequest.bind(this),learnAction:this._handleLearnAction.bind(this),learnFeedback:this._handleLearnFeedback.bind(this),startStopRecordActions:this._handleStartStopRecordActions.bind(this),variablesChanged:this._handleVariablesChanged.bind(this),sharedUdpSocketMessage:this._handleSharedUdpSocketMessage.bind(this),sharedUdpSocketError:this._handleSharedUdpSocketError.bind(this)},(e=>{process.send(e)}),5e3),process.on("message",(e=>{this.#$.receivedMessage(e)})),this.#G=new u.ActionManager((async e=>this.#$.sendWithCb("parseVariablesInString",e)),(e=>this.#$.sendWithNoCb("setActionDefinitions",e)),(e=>this.#$.sendWithNoCb("setCustomVariable",e)),this.log.bind(this)),this.#J=new c.FeedbackManager((async e=>this.#$.sendWithCb("parseVariablesInString",e)),(e=>this.#$.sendWithNoCb("updateFeedbackValues",e)),(e=>this.#$.sendWithNoCb("setFeedbackDefinitions",e)),this.log.bind(this)),this.#U=e.upgradeScripts,this.id=e.id,this.#K=e.id,this.log("debug","Initializing")}async _handleInit(e){return this.#F.add((async()=>{if(this.#B)throw new Error("Already initialized");const t=e.actions,r=e.feedbacks;if(this.#H=e.config,this.#K=e.label,e.isFirstInit){const t={},r=this.getConfigFields();for(const e of r)"default"in e&&(t[e.id]=e.default);this.#H=t,this.saveConfig(this.#H),e.lastUpgradeIndex=this.#U.length-1}const{updatedActions:s,updatedFeedbacks:n,updatedConfig:i}=(0,a.runThroughUpgradeScripts)(t,r,e.lastUpgradeIndex,this.#U,this.#H,!1);this.#H=i??this.#H;const o=this.#$.sendWithCb("upgradedItems",{updatedActions:s,updatedFeedbacks:n});try{await this.init(this.#H,!!e.isFirstInit),this.#B=!0}catch(e){throw console.trace(`Init failed: ${e}`),e}finally{await o}return setImmediate((()=>{this._handleUpdateActions({actions:t},!0).catch((e=>{this.log("error",`Receive actions failed: ${e}`)})),this._handleUpdateFeedbacks({feedbacks:r},!0).catch((e=>{this.log("error",`Receive feedbacks failed: ${e}`)}))})),{hasHttpHandler:"function"==typeof this.handleHttpRequest,hasRecordActionsHandler:"function"==typeof this.handleStartStopRecordActions,newUpgradeIndex:this.#U.length-1,updatedConfig:this.#H}}))}async _handleDestroy(){await this.#F.add((async()=>{if(!this.#B)throw new Error("Not initialized");await this.destroy(),this.#B=!1}))}async _handleConfigUpdateAndLabel(e){await this.#F.add((async()=>{if(!this.#B)throw new Error("Not initialized");this.#K=e.label,this.#H=e.config,await this.configUpdated(this.#H)}))}async _handleExecuteAction(e){return this.#G.handleExecuteAction(e)}async _handleUpdateFeedbacks(e,t){if(!t){const t=(0,a.runThroughUpgradeScripts)({},e.feedbacks,null,this.#U,this.#H,!0);this.#$.sendWithCb("upgradedItems",{updatedActions:t.updatedActions,updatedFeedbacks:t.updatedFeedbacks}).catch((e=>{this.log("error",`Failed to save upgraded feedbacks: ${e}`)}))}this.#J.handleUpdateFeedbacks(e.feedbacks)}async _handleUpdateActions(e,t){if(!t){const t=(0,a.runThroughUpgradeScripts)(e.actions,{},null,this.#U,this.#H,!0);this.#$.sendWithCb("upgradedItems",{updatedActions:t.updatedActions,updatedFeedbacks:t.updatedFeedbacks}).catch((e=>{this.log("error",`Failed to save upgraded actions: ${e}`)}))}this.#G.handleUpdateActions(e.actions)}async _handleGetConfigFields(e){return{fields:(0,o.serializeIsVisibleFn)(this.getConfigFields())}}async _handleHttpRequest(e){if(!this.handleHttpRequest)throw new Error("handleHttpRequest is not supported!");return{response:await this.handleHttpRequest(e.request)}}async _handleLearnAction(e){return this.#G.handleLearnAction(e)}async _handleLearnFeedback(e){return this.#J.handleLearnFeedback(e)}async _handleStartStopRecordActions(e){if(e.recording){if(this.#q)return}else if(!this.#q)return;if(!this.handleStartStopRecordActions)throw this.#q=!1,new Error("Recording actions is not supported by this module!");this.#q=e.recording,this.handleStartStopRecordActions(this.#q)}async _handleVariablesChanged(e){this.#J.handleVariablesChanged(e)}async _handleSharedUdpSocketMessage(e){for(const t of this.#z.values())t.handleId===e.handleId&&t.receiveSocketMessage(e)}async _handleSharedUdpSocketError(e){for(const t of this.#z.values())t.handleId===e.handleId&&t.receiveSocketError(e.error)}saveConfig(e){this.#H=e,this.#$.sendWithNoCb("saveConfig",{config:e})}setActionDefinitions(e){this.#G.setActionDefinitions(e)}setFeedbackDefinitions(e){this.#J.setFeedbackDefinitions(e)}setPresetDefinitions(e){const t=[];for(const[r,s]of Object.entries(e))s&&t.push({...s,id:r});this.#$.sendWithNoCb("setPresetDefinitions",{presets:t})}setVariableDefinitions(e){const t=[],r=[];this.#W.clear();for(const s of e)t.push({id:s.variableId,name:s.name}),this.#W.set(s.variableId,s),this.#Q.has(s.variableId)||(this.#Q.set(s.variableId,""),r.push({id:s.variableId,value:""}));if(!this.#r.disableVariableValidation){const e=new Set(this.#W.keys());for(const t of this.#Q.keys())e.has(t)||(this.#Q.delete(t),r.push({id:t,value:void 0}))}this.#$.sendWithNoCb("setVariableDefinitions",{variables:t,newValues:r})}setVariableValues(e){const t=[];for(const[r,s]of Object.entries(e))this.#r.disableVariableValidation?(void 0===s?this.#Q.delete(r):this.#Q.set(r,s),t.push({id:r,value:s})):this.#W.has(r)?(this.#Q.set(r,s??""),t.push({id:r,value:s??""})):t.push({id:r,value:void 0});this.#$.sendWithNoCb("setVariableValues",{newValues:t})}getVariableValue(e){return this.#Q.get(e)}async parseVariablesInString(e){const t=this.#J.parseVariablesContext;return t&&this.log("debug",`parseVariablesInString called while in: ${t}. You should use the parseVariablesInString provided to the callback instead`),(await this.#$.sendWithCb("parseVariablesInString",{text:e,controlId:void 0,actionInstanceId:void 0,feedbackInstanceId:void 0})).text}checkFeedbacks(...e){this.#J.checkFeedbacks(e)}checkFeedbacksById(...e){this.#J.checkFeedbacksById(e)}subscribeActions(...e){this.#G.subscribeActions(e)}unsubscribeActions(...e){this.#G.unsubscribeActions(e)}subscribeFeedbacks(...e){this.#J.subscribeFeedbacks(e)}unsubscribeFeedbacks(...e){this.#J.unsubscribeFeedbacks(e)}recordAction(e,t){if(!this.#q)throw new Error("Not currently recording actions");this.#$.sendWithNoCb("recordAction",{uniquenessId:t??null,actionId:e.actionId,options:e.options,delay:e.delay})}oscSend(e,t,r,s){this.#$.sendWithNoCb("send-osc",(0,n.literal)({host:e,port:t,path:r,args:s}))}updateStatus(e,t){this.#$.sendWithNoCb("set-status",(0,n.literal)({status:e,message:t??null}))}log(e,t){this.#$.sendWithNoCb("log-message",(0,n.literal)({level:e,message:t}))}createSharedUdpSocket(e,t){const r="string"==typeof e?{type:e}:e,s=new d.SharedUdpSocketImpl(this.#$,this.#z,r);return t&&s.on("message",t),s}}},7386:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},1400:(e,t)=>{"use strict";var r,s;Object.defineProperty(t,"__esModule",{value:!0}),t.Regex=t.InstanceStatus=void 0,function(e){e.Ok="ok",e.Connecting="connecting",e.Disconnected="disconnected",e.ConnectionFailure="connection_failure",e.BadConfig="bad_config",e.UnknownError="unknown_error",e.UnknownWarning="unknown_warning",e.AuthenticationFailure="authentication_failure"}(r||(t.InstanceStatus=r={})),function(e){e.IP="/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/",e.HOSTNAME="/^(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9-]*[a-zA-Z0-9])\\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9-]*[A-Za-z0-9])$/",e.BOOLEAN="/^(true|false|0|1)$/i",e.PORT="/^([1-9]|[1-8][0-9]|9[0-9]|[1-8][0-9]{2}|9[0-8][0-9]|99[0-9]|[1-8][0-9]{3}|9[0-8][0-9]{2}|99[0-8][0-9]|999[0-9]|[1-5][0-9]{4}|6[0-4][0-9]{3}|65[0-4][0-9]{2}|655[0-2][0-9]|6553[0-4])$/",e.MAC_ADDRESS="/^(?:[a-fA-F0-9]{2}:){5}([a-fA-F0-9]{2})$/",e.PERCENT="/^(100|[0-9]|[0-9][0-9])$/",e.FLOAT="/^([0-9]*\\.)?[0-9]+$/",e.SIGNED_FLOAT="/^[+-]?([0-9]*\\.)?[0-9]+$/",e.FLOAT_OR_INT="/^([0-9]+)(\\.[0-9]+)?$/",e.NUMBER="/^\\d+$/",e.SIGNED_NUMBER="/^[+-]?\\d+$/",e.SOMETHING="/^.+$/",e.TIMECODE="/^(0*[0-9]|1[0-9]|2[0-4]):(0*[0-9]|[1-5][0-9]|60):(0*[0-9]|[1-5][0-9]|60):(0*[0-9]|[12][0-9]|30)$/"}(s||(t.Regex=s={}))},8983:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},8104:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},2018:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=r(1635);s.__exportStar(r(3730),t),s.__exportStar(r(1649),t),s.__exportStar(r(7386),t),s.__exportStar(r(1400),t),s.__exportStar(r(8983),t),s.__exportStar(r(8104),t),s.__exportStar(r(3258),t),s.__exportStar(r(131),t),s.__exportStar(r(3371),t),s.__exportStar(r(9786),t),s.__exportStar(r(6132),t)},3258:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},131:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},2365:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SharedUdpSocketImpl=void 0;const s=r(1635).__importDefault(r(228)),n=r(360);class i extends s.default{#$;#Y;#r;get handleId(){return this.boundState?.handleId}get portNumber(){return this.boundState?.portNumber}get boundState(){return this.#b&&"object"==typeof this.#b?this.#b:void 0}#b="pending";constructor(e,t,r){super(),this.#$=e,this.#Y=t,this.#r={...r}}bind(e,t,r){if(this.#b&&"object"==typeof this.#b)throw new Error("Socket is already bound");switch(this.#b){case"fatalError":throw new Error("Socket has encountered fatal error");case"binding":throw new Error("Socket is already bound");case"closed":throw new Error("Socket is closing");case"pending":break;default:throw(0,n.assertNever)(this.#b),new Error("Invalid socket state")}this.#b="binding",r&&this.on("listening",r),this.#$.sendWithCb("sharedUdpSocketJoin",{family:this.#r.type,portNumber:e}).then((t=>{this.#b={portNumber:e,handleId:t},this.#Y.set(t,this),this.emit("listening")}),(e=>{this.#b="closed",this.emit("error",e instanceof Error?e:new Error(e))})).catch((()=>null))}close(e){if(this.#b&&"object"==typeof this.#b);else switch(this.#b){case"fatalError":throw new Error("Socket has encountered fatal error");case"pending":case"closed":case"binding":throw new Error("Socket is not open");default:throw(0,n.assertNever)(this.#b),new Error("Invalid socket state")}const t=this.#b.handleId;this.#b="closed",e&&this.on("close",e),this.#$.sendWithCb("sharedUdpSocketLeave",{handleId:t}).then((()=>{this.#Y.delete(t),this.emit("close")}),(e=>{this.#Y.delete(t),this.emit("error",e instanceof Error?e:new Error(e))})).catch((()=>null))}send(e,t,r,s,n,i){if("number"!=typeof t)throw new Error("Invalid arguments");if("number"==typeof r){if("number"!=typeof s||"string"!=typeof n)throw new Error("Invalid arguments");if(void 0!==i&&"function"!=typeof i)throw new Error("Invalid arguments");const o=this.#Z(e,t,r);this.#X(o,s,n,i)}else{if("string"!=typeof r)throw new Error("Invalid arguments");{if(void 0!==s&&"function"!=typeof s)throw new Error("Invalid arguments");const n=this.#Z(e,0,void 0);this.#X(n,t,r,s)}}}#Z(e,t,r){let s;if("string"==typeof e)s=Buffer.from(e,"utf-8");else if(Buffer.isBuffer(e))s=e;else{if(Array.isArray(e))return Buffer.from(e);s=Buffer.from(e.buffer,e.byteOffset,e.byteLength)}return s.subarray(t,void 0!==r?r+t:void 0)}#X(e,t,r,s){if(!this.#b||"object"!=typeof this.#b)throw new Error("Socket is not open");this.#$.sendWithCb("sharedUdpSocketSend",{handleId:this.#b.handleId,message:e,address:r,port:t}).then((()=>{s?.()}),(e=>{this.emit("error",e instanceof Error?e:new Error(e))})).catch((()=>null))}receiveSocketMessage(e){try{this.emit("message",e.message,e.source)}catch(e){}}receiveSocketError(e){this.#b="fatalError";const t=this.boundState;t&&this.#Y.delete(t.handleId);try{this.emit("error",e)}catch(e){}}}t.SharedUdpSocketImpl=i},3371:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},9786:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EmptyUpgradeScript=void 0,t.CreateConvertToBooleanFeedbackUpgradeScript=function(e){return(t,r)=>{const s=[];for(const t of r.feedbacks){let r=e[t.feedbackId];if(!0===r&&(r={bg:"bgcolor",bgcolor:"bgcolor",fg:"color",color:"color",png64:"png64",png:"png64"}),r){t.style||(t.style={});for(const[e,n]of Object.entries(r))void 0!==t.options[e]&&(t.style[n]=t.options[e],delete t.options[e],s.push(t))}}return{updatedConfig:null,updatedActions:[],updatedFeedbacks:s}}},t.CreateUseBuiltinInvertForFeedbacksUpgradeScript=function(e){return(t,r)=>{const s=[];for(const t of r.feedbacks){const r=e[t.feedbackId];if("string"!=typeof r)continue;const n=t.options[r];void 0!==n&&(delete t.options[r],t.isInverted="true"===n||!0===n||Number(n)>0,s.push(t))}return{updatedConfig:null,updatedActions:[],updatedFeedbacks:s}}},t.EmptyUpgradeScript=()=>({updatedConfig:null,updatedActions:[],updatedFeedbacks:[]})},6132:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},360:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.literal=function(e){return e},t.assertNever=function(e){},t.combineRgb=function(e,t,r,s){let n=(255&e)<<16|(255&t)<<8|255&r;return s&&s>=0&&s<1&&(n+=16777216*Math.round(255*(1-s))),n},t.splitRgb=n,t.splitHsl=function(e){const t=n(e);return(0,s.colord)(`rgba(${t.r}, ${t.g}, ${t.b}, ${t.a})`).toHsl()},t.splitHsv=function(e){const t=n(e);return(0,s.colord)(`rgba(${t.r}, ${t.g}, ${t.b}, ${t.a})`).toHsv()},t.splitHex=function(e){const t=n(e);return(0,s.colord)(`rgba(${t.r}, ${t.g}, ${t.b}, ${t.a})`).toHex()},t.parseEscapeCharacters=function(e){return e.replaceAll("\\n","\n").replaceAll("\\r","\r").replaceAll("\\t","\t").replaceAll("\\f","\f").replaceAll("\\v","\v").replaceAll("\\b","\b").replaceAll("\\\\","\\").replaceAll("\\x00","\0").replaceAll("\\x01","").replaceAll("\\x02","").replaceAll("\\x03","")},t.substituteEscapeCharacters=function(e){return e.replaceAll("\n","\\n").replaceAll("\r","\\r").replaceAll("\t","\\t").replaceAll("\f","\\f").replaceAll("\v","\\v").replaceAll("\b","\\b").replaceAll("\\","\\\\").replaceAll("\0","\\x00").replaceAll("","\\x01").replaceAll("","\\x02").replaceAll("","\\x03")};const s=r(6284);function n(e){if("number"==typeof e)return e>16777215?{r:e>>16&255,g:e>>8&255,b:255&e,a:(255-(e>>24&255))/255}:{r:e>>16&255,g:e>>8&255,b:255&e,a:1};if("string"==typeof e&&(0,s.colord)(e).isValid()){const t=(0,s.colord)(e).toRgb();return{r:t.r,g:t.g,b:t.b,a:t.a}}return{r:0,g:0,b:0,a:1}}},7281:(e,t,r)=>{"use strict";e.exports=a,e.exports.default=a;const s={$schema:"http://json-schema.org/draft-07/schema#",type:"object",title:"ModuleManifest",properties:{$schema:{type:"string"},id:{type:"string",description:"Unique identifier for the module"},name:{type:"string",description:"Name of the module"},shortname:{type:"string"},description:{type:"string",description:"Description of the module "},version:{type:"string",description:"Current version of the module"},isPrerelease:{type:"boolean",description:"Is this a pre-release version"},license:{type:"string",description:"SPDX identifier for license of the module"},repository:{type:"string",description:"URL to the source repository"},bugs:{type:"string",description:"URL to bug tracker"},maintainers:{type:"array",description:"List of active maintiners",uniqueItems:!0,items:{type:"object",title:"ModuleManifestMaintainer",properties:{name:{type:"string"},email:{type:"string"},github:{type:"string"},url:{type:"string"}},required:["name"],additionalProperties:!1}},legacyIds:{type:"array",description:"If the module had a different unique identifier previously, then specify it here",uniqueItems:!0,items:{type:"string"}},runtime:{type:"object",title:"ModuleManifestRuntime",description:"Information on how to execute the module",properties:{type:{type:"string",description:"Type of the module. Must be: node18 or node22",enum:["node18","node22"]},api:{type:"string",description:"Which host-api does it use. In the future alternate options will be allowed",enum:["nodejs-ipc"]},apiVersion:{type:"string",description:"The version of the host-api used"},entrypoint:{type:"string",description:"Entrypoint to pass to the runtime. eg index.js"},permissions:{type:"object",description:"Permissions required by the module. This is used to inform the user of the permissions required by the module.\nNote: this requires the node22 or newer runtime",properties:{"worker-threads":{type:"boolean",description:"Enable if the module uses worker threads"},"child-process":{type:"boolean",description:"Enable if the module uses child processes"},"native-addons":{type:"boolean",description:"Enable if the module uses native addons"},filesystem:{type:"boolean",description:"Enable if the module requires read/write access to the filesystem"}},additionalProperties:!1}},required:["type","api","apiVersion","entrypoint"]},manufacturer:{type:"string"},products:{type:"array",uniqueItems:!0,items:{type:"string"},minItems:1},keywords:{type:"array",uniqueItems:!0,items:{type:"string"}},bonjourQueries:{type:"object",description:"If the device or software for your module supports bonjour announcements, Companion will offer an easy way to watch for these announcements.\nEach query you define must have a matching config field of type 'bonjour-device' with the same name",patternProperties:{"":{oneOf:[{$ref:"#/definitions/bonjourQuery"},{type:"array",items:{$ref:"#/definitions/bonjourQuery"}}]}}}},required:["id","name","shortname","description","version","license","repository","bugs","maintainers","legacyIds","runtime","manufacturer","products","keywords"],definitions:{bonjourQuery:{type:"object",title:"ModuleBonjourQuery",description:"",properties:{type:{type:"string"},protocol:{type:"string",enum:["tcp","udp"]},port:{type:"number"},txt:{type:"object",description:"Match on any txt values returned in the query. This is useful to filter out devices of the same 'type' that are not supported",patternProperties:{"":{type:"string"}}}},required:["type","protocol"]}}},n={type:"object",title:"ModuleBonjourQuery",description:"",properties:{type:{type:"string"},protocol:{type:"string",enum:["tcp","udp"]},port:{type:"number"},txt:{type:"object",description:"Match on any txt values returned in the query. This is useful to filter out devices of the same 'type' that are not supported",patternProperties:{"":{type:"string"}}}},required:["type","protocol"]},i=r(7169).A,o=new RegExp("","u");function a(e,{instancePath:t="",parentData:r,parentDataProperty:c,rootData:l=e}={}){let u=null,d=0;if(0===d){if(!e||"object"!=typeof e||Array.isArray(e))return a.errors=[{instancePath:t,schemaPath:"#/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;{let r;if(void 0===e.id&&(r="id")||void 0===e.name&&(r="name")||void 0===e.shortname&&(r="shortname")||void 0===e.description&&(r="description")||void 0===e.version&&(r="version")||void 0===e.license&&(r="license")||void 0===e.repository&&(r="repository")||void 0===e.bugs&&(r="bugs")||void 0===e.maintainers&&(r="maintainers")||void 0===e.legacyIds&&(r="legacyIds")||void 0===e.runtime&&(r="runtime")||void 0===e.manufacturer&&(r="manufacturer")||void 0===e.products&&(r="products")||void 0===e.keywords&&(r="keywords"))return a.errors=[{instancePath:t,schemaPath:"#/required",keyword:"required",params:{missingProperty:r},message:"must have required property '"+r+"'"}],!1;if(void 0!==e.$schema){const r=d;if("string"!=typeof e.$schema)return a.errors=[{instancePath:t+"/$schema",schemaPath:"#/properties/%24schema/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var h=r===d}else h=!0;if(h){if(void 0!==e.id){const r=d;if("string"!=typeof e.id)return a.errors=[{instancePath:t+"/id",schemaPath:"#/properties/id/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;h=r===d}else h=!0;if(h){if(void 0!==e.name){const r=d;if("string"!=typeof e.name)return a.errors=[{instancePath:t+"/name",schemaPath:"#/properties/name/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;h=r===d}else h=!0;if(h){if(void 0!==e.shortname){const r=d;if("string"!=typeof e.shortname)return a.errors=[{instancePath:t+"/shortname",schemaPath:"#/properties/shortname/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;h=r===d}else h=!0;if(h){if(void 0!==e.description){const r=d;if("string"!=typeof e.description)return a.errors=[{instancePath:t+"/description",schemaPath:"#/properties/description/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;h=r===d}else h=!0;if(h){if(void 0!==e.version){const r=d;if("string"!=typeof e.version)return a.errors=[{instancePath:t+"/version",schemaPath:"#/properties/version/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;h=r===d}else h=!0;if(h){if(void 0!==e.isPrerelease){const r=d;if("boolean"!=typeof e.isPrerelease)return a.errors=[{instancePath:t+"/isPrerelease",schemaPath:"#/properties/isPrerelease/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"}],!1;h=r===d}else h=!0;if(h){if(void 0!==e.license){const r=d;if("string"!=typeof e.license)return a.errors=[{instancePath:t+"/license",schemaPath:"#/properties/license/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;h=r===d}else h=!0;if(h){if(void 0!==e.repository){const r=d;if("string"!=typeof e.repository)return a.errors=[{instancePath:t+"/repository",schemaPath:"#/properties/repository/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;h=r===d}else h=!0;if(h){if(void 0!==e.bugs){const r=d;if("string"!=typeof e.bugs)return a.errors=[{instancePath:t+"/bugs",schemaPath:"#/properties/bugs/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;h=r===d}else h=!0;if(h){if(void 0!==e.maintainers){let r=e.maintainers;const s=d;if(d===s){if(!Array.isArray(r))return a.errors=[{instancePath:t+"/maintainers",schemaPath:"#/properties/maintainers/type",keyword:"type",params:{type:"array"},message:"must be array"}],!1;{var p=!0;const e=r.length;for(let s=0;s<e;s++){let e=r[s];const n=d;if(d===n){if(!e||"object"!=typeof e||Array.isArray(e))return a.errors=[{instancePath:t+"/maintainers/"+s,schemaPath:"#/properties/maintainers/items/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;{let r;if(void 0===e.name&&(r="name"))return a.errors=[{instancePath:t+"/maintainers/"+s,schemaPath:"#/properties/maintainers/items/required",keyword:"required",params:{missingProperty:r},message:"must have required property '"+r+"'"}],!1;{const r=d;for(const r in e)if("name"!==r&&"email"!==r&&"github"!==r&&"url"!==r)return a.errors=[{instancePath:t+"/maintainers/"+s,schemaPath:"#/properties/maintainers/items/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:r},message:"must NOT have additional properties"}],!1;if(r===d){if(void 0!==e.name){const r=d;if("string"!=typeof e.name)return a.errors=[{instancePath:t+"/maintainers/"+s+"/name",schemaPath:"#/properties/maintainers/items/properties/name/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;var f=r===d}else f=!0;if(f){if(void 0!==e.email){const r=d;if("string"!=typeof e.email)return a.errors=[{instancePath:t+"/maintainers/"+s+"/email",schemaPath:"#/properties/maintainers/items/properties/email/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;f=r===d}else f=!0;if(f){if(void 0!==e.github){const r=d;if("string"!=typeof e.github)return a.errors=[{instancePath:t+"/maintainers/"+s+"/github",schemaPath:"#/properties/maintainers/items/properties/github/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;f=r===d}else f=!0;if(f)if(void 0!==e.url){const r=d;if("string"!=typeof e.url)return a.errors=[{instancePath:t+"/maintainers/"+s+"/url",schemaPath:"#/properties/maintainers/items/properties/url/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;f=r===d}else f=!0}}}}}}if(!(p=n===d))break}if(p){let e,s=r.length;if(s>1)for(;s--;)for(e=s;e--;)if(i(r[s],r[e]))return a.errors=[{instancePath:t+"/maintainers",schemaPath:"#/properties/maintainers/uniqueItems",keyword:"uniqueItems",params:{i:s,j:e},message:"must NOT have duplicate items (items ## "+e+" and "+s+" are identical)"}],!1}}}h=s===d}else h=!0;if(h){if(void 0!==e.legacyIds){let r=e.legacyIds;const s=d;if(d===s){if(!Array.isArray(r))return a.errors=[{instancePath:t+"/legacyIds",schemaPath:"#/properties/legacyIds/type",keyword:"type",params:{type:"array"},message:"must be array"}],!1;{var b=!0;const e=r.length;for(let s=0;s<e;s++){const e=d;if("string"!=typeof r[s])return a.errors=[{instancePath:t+"/legacyIds/"+s,schemaPath:"#/properties/legacyIds/items/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(!(b=e===d))break}if(b){let e,s=r.length;if(s>1){const n={};for(;s--;){let i=r[s];if("string"==typeof i){if("number"==typeof n[i])return e=n[i],a.errors=[{instancePath:t+"/legacyIds",schemaPath:"#/properties/legacyIds/uniqueItems",keyword:"uniqueItems",params:{i:s,j:e},message:"must NOT have duplicate items (items ## "+e+" and "+s+" are identical)"}],!1;n[i]=s}}}}}}h=s===d}else h=!0;if(h){if(void 0!==e.runtime){let r=e.runtime;const n=d;if(d===n){if(!r||"object"!=typeof r||Array.isArray(r))return a.errors=[{instancePath:t+"/runtime",schemaPath:"#/properties/runtime/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;{let e;if(void 0===r.type&&(e="type")||void 0===r.api&&(e="api")||void 0===r.apiVersion&&(e="apiVersion")||void 0===r.entrypoint&&(e="entrypoint"))return a.errors=[{instancePath:t+"/runtime",schemaPath:"#/properties/runtime/required",keyword:"required",params:{missingProperty:e},message:"must have required property '"+e+"'"}],!1;if(void 0!==r.type){let e=r.type;const n=d;if("string"!=typeof e)return a.errors=[{instancePath:t+"/runtime/type",schemaPath:"#/properties/runtime/properties/type/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if("node18"!==e&&"node22"!==e)return a.errors=[{instancePath:t+"/runtime/type",schemaPath:"#/properties/runtime/properties/type/enum",keyword:"enum",params:{allowedValues:s.properties.runtime.properties.type.enum},message:"must be equal to one of the allowed values"}],!1;var g=n===d}else g=!0;if(g){if(void 0!==r.api){let e=r.api;const n=d;if("string"!=typeof e)return a.errors=[{instancePath:t+"/runtime/api",schemaPath:"#/properties/runtime/properties/api/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if("nodejs-ipc"!==e)return a.errors=[{instancePath:t+"/runtime/api",schemaPath:"#/properties/runtime/properties/api/enum",keyword:"enum",params:{allowedValues:s.properties.runtime.properties.api.enum},message:"must be equal to one of the allowed values"}],!1;g=n===d}else g=!0;if(g){if(void 0!==r.apiVersion){const e=d;if("string"!=typeof r.apiVersion)return a.errors=[{instancePath:t+"/runtime/apiVersion",schemaPath:"#/properties/runtime/properties/apiVersion/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;g=e===d}else g=!0;if(g){if(void 0!==r.entrypoint){const e=d;if("string"!=typeof r.entrypoint)return a.errors=[{instancePath:t+"/runtime/entrypoint",schemaPath:"#/properties/runtime/properties/entrypoint/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;g=e===d}else g=!0;if(g)if(void 0!==r.permissions){let e=r.permissions;const s=d;if(d===s){if(!e||"object"!=typeof e||Array.isArray(e))return a.errors=[{instancePath:t+"/runtime/permissions",schemaPath:"#/properties/runtime/properties/permissions/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;{const r=d;for(const r in e)if("worker-threads"!==r&&"child-process"!==r&&"native-addons"!==r&&"filesystem"!==r)return a.errors=[{instancePath:t+"/runtime/permissions",schemaPath:"#/properties/runtime/properties/permissions/additionalProperties",keyword:"additionalProperties",params:{additionalProperty:r},message:"must NOT have additional properties"}],!1;if(r===d){if(void 0!==e["worker-threads"]){const r=d;if("boolean"!=typeof e["worker-threads"])return a.errors=[{instancePath:t+"/runtime/permissions/worker-threads",schemaPath:"#/properties/runtime/properties/permissions/properties/worker-threads/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"}],!1;var y=r===d}else y=!0;if(y){if(void 0!==e["child-process"]){const r=d;if("boolean"!=typeof e["child-process"])return a.errors=[{instancePath:t+"/runtime/permissions/child-process",schemaPath:"#/properties/runtime/properties/permissions/properties/child-process/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"}],!1;y=r===d}else y=!0;if(y){if(void 0!==e["native-addons"]){const r=d;if("boolean"!=typeof e["native-addons"])return a.errors=[{instancePath:t+"/runtime/permissions/native-addons",schemaPath:"#/properties/runtime/properties/permissions/properties/native-addons/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"}],!1;y=r===d}else y=!0;if(y)if(void 0!==e.filesystem){const r=d;if("boolean"!=typeof e.filesystem)return a.errors=[{instancePath:t+"/runtime/permissions/filesystem",schemaPath:"#/properties/runtime/properties/permissions/properties/filesystem/type",keyword:"type",params:{type:"boolean"},message:"must be boolean"}],!1;y=r===d}else y=!0}}}}}g=s===d}else g=!0}}}}}h=n===d}else h=!0;if(h){if(void 0!==e.manufacturer){const r=d;if("string"!=typeof e.manufacturer)return a.errors=[{instancePath:t+"/manufacturer",schemaPath:"#/properties/manufacturer/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;h=r===d}else h=!0;if(h){if(void 0!==e.products){let r=e.products;const s=d;if(d===s){if(!Array.isArray(r))return a.errors=[{instancePath:t+"/products",schemaPath:"#/properties/products/type",keyword:"type",params:{type:"array"},message:"must be array"}],!1;if(r.length<1)return a.errors=[{instancePath:t+"/products",schemaPath:"#/properties/products/minItems",keyword:"minItems",params:{limit:1},message:"must NOT have fewer than 1 items"}],!1;{var m=!0;const e=r.length;for(let s=0;s<e;s++){const e=d;if("string"!=typeof r[s])return a.errors=[{instancePath:t+"/products/"+s,schemaPath:"#/properties/products/items/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(!(m=e===d))break}if(m){let e,s=r.length;if(s>1){const n={};for(;s--;){let i=r[s];if("string"==typeof i){if("number"==typeof n[i])return e=n[i],a.errors=[{instancePath:t+"/products",schemaPath:"#/properties/products/uniqueItems",keyword:"uniqueItems",params:{i:s,j:e},message:"must NOT have duplicate items (items ## "+e+" and "+s+" are identical)"}],!1;n[i]=s}}}}}}h=s===d}else h=!0;if(h){if(void 0!==e.keywords){let r=e.keywords;const s=d;if(d===s){if(!Array.isArray(r))return a.errors=[{instancePath:t+"/keywords",schemaPath:"#/properties/keywords/type",keyword:"type",params:{type:"array"},message:"must be array"}],!1;{var _=!0;const e=r.length;for(let s=0;s<e;s++){const e=d;if("string"!=typeof r[s])return a.errors=[{instancePath:t+"/keywords/"+s,schemaPath:"#/properties/keywords/items/type",keyword:"type",params:{type:"string"},message:"must be string"}],!1;if(!(_=e===d))break}if(_){let e,s=r.length;if(s>1){const n={};for(;s--;){let i=r[s];if("string"==typeof i){if("number"==typeof n[i])return e=n[i],a.errors=[{instancePath:t+"/keywords",schemaPath:"#/properties/keywords/uniqueItems",keyword:"uniqueItems",params:{i:s,j:e},message:"must NOT have duplicate items (items ## "+e+" and "+s+" are identical)"}],!1;n[i]=s}}}}}}h=s===d}else h=!0;if(h)if(void 0!==e.bonjourQueries){let r=e.bonjourQueries;const s=d;if(d===s){if(!r||"object"!=typeof r||Array.isArray(r))return a.errors=[{instancePath:t+"/bonjourQueries",schemaPath:"#/properties/bonjourQueries/type",keyword:"type",params:{type:"object"},message:"must be object"}],!1;for(const e in r)if(o.test(e)){let s=r[e];const i=d,c=d;let l=!1,h=null;const p=d;if(d==d)if(s&&"object"==typeof s&&!Array.isArray(s)){let r;if(void 0===s.type&&(r="type")||void 0===s.protocol&&(r="protocol")){const s={instancePath:t+"/bonjourQueries/"+e.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/definitions/bonjourQuery/required",keyword:"required",params:{missingProperty:r},message:"must have required property '"+r+"'"};null===u?u=[s]:u.push(s),d++}else{if(void 0!==s.type){const r=d;if("string"!=typeof s.type){const r={instancePath:t+"/bonjourQueries/"+e.replace(/~/g,"~0").replace(/\//g,"~1")+"/type",schemaPath:"#/definitions/bonjourQuery/properties/type/type",keyword:"type",params:{type:"string"},message:"must be string"};null===u?u=[r]:u.push(r),d++}var v=r===d}else v=!0;if(v){if(void 0!==s.protocol){let r=s.protocol;const i=d;if("string"!=typeof r){const r={instancePath:t+"/bonjourQueries/"+e.replace(/~/g,"~0").replace(/\//g,"~1")+"/protocol",schemaPath:"#/definitions/bonjourQuery/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};null===u?u=[r]:u.push(r),d++}if("tcp"!==r&&"udp"!==r){const r={instancePath:t+"/bonjourQueries/"+e.replace(/~/g,"~0").replace(/\//g,"~1")+"/protocol",schemaPath:"#/definitions/bonjourQuery/properties/protocol/enum",keyword:"enum",params:{allowedValues:n.properties.protocol.enum},message:"must be equal to one of the allowed values"};null===u?u=[r]:u.push(r),d++}v=i===d}else v=!0;if(v){if(void 0!==s.port){let r=s.port;const n=d;if("number"!=typeof r||!isFinite(r)){const r={instancePath:t+"/bonjourQueries/"+e.replace(/~/g,"~0").replace(/\//g,"~1")+"/port",schemaPath:"#/definitions/bonjourQuery/properties/port/type",keyword:"type",params:{type:"number"},message:"must be number"};null===u?u=[r]:u.push(r),d++}v=n===d}else v=!0;if(v)if(void 0!==s.txt){let r=s.txt;const n=d;if(d===n)if(r&&"object"==typeof r&&!Array.isArray(r)){for(const s in r)if(o.test(s)){const n=d;if("string"!=typeof r[s]){const r={instancePath:t+"/bonjourQueries/"+e.replace(/~/g,"~0").replace(/\//g,"~1")+"/txt/"+s.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/definitions/bonjourQuery/properties/txt/patternProperties//type",keyword:"type",params:{type:"string"},message:"must be string"};null===u?u=[r]:u.push(r),d++}if(n!==d)break}}else{const r={instancePath:t+"/bonjourQueries/"+e.replace(/~/g,"~0").replace(/\//g,"~1")+"/txt",schemaPath:"#/definitions/bonjourQuery/properties/txt/type",keyword:"type",params:{type:"object"},message:"must be object"};null===u?u=[r]:u.push(r),d++}v=n===d}else v=!0}}}}else{const r={instancePath:t+"/bonjourQueries/"+e.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/definitions/bonjourQuery/type",keyword:"type",params:{type:"object"},message:"must be object"};null===u?u=[r]:u.push(r),d++}p===d&&(l=!0,h=0);const f=d;if(d===f)if(Array.isArray(s)){const r=s.length;for(let i=0;i<r;i++){let r=s[i];const a=d;if(d==d)if(r&&"object"==typeof r&&!Array.isArray(r)){let s;if(void 0===r.type&&(s="type")||void 0===r.protocol&&(s="protocol")){const r={instancePath:t+"/bonjourQueries/"+e.replace(/~/g,"~0").replace(/\//g,"~1")+"/"+i,schemaPath:"#/definitions/bonjourQuery/required",keyword:"required",params:{missingProperty:s},message:"must have required property '"+s+"'"};null===u?u=[r]:u.push(r),d++}else{if(void 0!==r.type){const s=d;if("string"!=typeof r.type){const r={instancePath:t+"/bonjourQueries/"+e.replace(/~/g,"~0").replace(/\//g,"~1")+"/"+i+"/type",schemaPath:"#/definitions/bonjourQuery/properties/type/type",keyword:"type",params:{type:"string"},message:"must be string"};null===u?u=[r]:u.push(r),d++}var I=s===d}else I=!0;if(I){if(void 0!==r.protocol){let s=r.protocol;const o=d;if("string"!=typeof s){const r={instancePath:t+"/bonjourQueries/"+e.replace(/~/g,"~0").replace(/\//g,"~1")+"/"+i+"/protocol",schemaPath:"#/definitions/bonjourQuery/properties/protocol/type",keyword:"type",params:{type:"string"},message:"must be string"};null===u?u=[r]:u.push(r),d++}if("tcp"!==s&&"udp"!==s){const r={instancePath:t+"/bonjourQueries/"+e.replace(/~/g,"~0").replace(/\//g,"~1")+"/"+i+"/protocol",schemaPath:"#/definitions/bonjourQuery/properties/protocol/enum",keyword:"enum",params:{allowedValues:n.properties.protocol.enum},message:"must be equal to one of the allowed values"};null===u?u=[r]:u.push(r),d++}I=o===d}else I=!0;if(I){if(void 0!==r.port){let s=r.port;const n=d;if("number"!=typeof s||!isFinite(s)){const r={instancePath:t+"/bonjourQueries/"+e.replace(/~/g,"~0").replace(/\//g,"~1")+"/"+i+"/port",schemaPath:"#/definitions/bonjourQuery/properties/port/type",keyword:"type",params:{type:"number"},message:"must be number"};null===u?u=[r]:u.push(r),d++}I=n===d}else I=!0;if(I)if(void 0!==r.txt){let s=r.txt;const n=d;if(d===n)if(s&&"object"==typeof s&&!Array.isArray(s)){for(const r in s)if(o.test(r)){const n=d;if("string"!=typeof s[r]){const s={instancePath:t+"/bonjourQueries/"+e.replace(/~/g,"~0").replace(/\//g,"~1")+"/"+i+"/txt/"+r.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/definitions/bonjourQuery/properties/txt/patternProperties//type",keyword:"type",params:{type:"string"},message:"must be string"};null===u?u=[s]:u.push(s),d++}if(n!==d)break}}else{const r={instancePath:t+"/bonjourQueries/"+e.replace(/~/g,"~0").replace(/\//g,"~1")+"/"+i+"/txt",schemaPath:"#/definitions/bonjourQuery/properties/txt/type",keyword:"type",params:{type:"object"},message:"must be object"};null===u?u=[r]:u.push(r),d++}I=n===d}else I=!0}}}}else{const r={instancePath:t+"/bonjourQueries/"+e.replace(/~/g,"~0").replace(/\//g,"~1")+"/"+i,schemaPath:"#/definitions/bonjourQuery/type",keyword:"type",params:{type:"object"},message:"must be object"};null===u?u=[r]:u.push(r),d++}if(a!==d)break}}else{const r={instancePath:t+"/bonjourQueries/"+e.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/bonjourQueries/patternProperties//oneOf/1/type",keyword:"type",params:{type:"array"},message:"must be array"};null===u?u=[r]:u.push(r),d++}var T;if((T=f===d)&&l?(l=!1,h=[h,1]):T&&(l=!0,h=1),!l){const r={instancePath:t+"/bonjourQueries/"+e.replace(/~/g,"~0").replace(/\//g,"~1"),schemaPath:"#/properties/bonjourQueries/patternProperties//oneOf",keyword:"oneOf",params:{passingSchemas:h},message:"must match exactly one schema in oneOf"};return null===u?u=[r]:u.push(r),d++,a.errors=u,!1}if(d=c,null!==u&&(c?u.length=c:u=null),i!==d)break}}h=s===d}else h=!0}}}}}}}}}}}}}}}}}return a.errors=u,0===d}},7e3:(e,t,r)=>{"use strict";const s=r(4865);e.exports=(e,t={})=>{if("function"!=typeof e)throw new TypeError(`Expected the first argument to be a function, got \`${typeof e}\``);const{wait:r=0,maxWait:n=0,before:i=!1,after:o=!0}=t;if(!i&&!o)throw new Error("Both `before` and `after` are false, function wouldn't be called.");let a,c,l;const u=function(...t){const s=this,u=i&&!a;return clearTimeout(a),a=setTimeout((()=>{a=void 0,c&&(clearTimeout(c),c=void 0),o&&(l=e.apply(s,t))}),r),n>0&&!c&&o&&(c=setTimeout((()=>{c=void 0,a&&(clearTimeout(a),a=void 0),l=e.apply(s,t)}),n)),u&&(l=e.apply(s,t)),l};return s(u,e),u.cancel=()=>{a&&(clearTimeout(a),a=void 0),c&&(clearTimeout(c),c=void 0)},u}},4241:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return null==e?"":`${e}`}},1776:function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.object=t.symbol=t.stringExcel=t.stringQuoteOnlyIfNecessary=t.string=t.number=t.default=void 0;var n=r(4241);Object.defineProperty(t,"default",{enumerable:!0,get:function(){return s(n).default}});var i=r(6159);Object.defineProperty(t,"number",{enumerable:!0,get:function(){return s(i).default}});var o=r(9807);Object.defineProperty(t,"string",{enumerable:!0,get:function(){return s(o).default}});var a=r(6207);Object.defineProperty(t,"stringQuoteOnlyIfNecessary",{enumerable:!0,get:function(){return s(a).default}});var c=r(6576);Object.defineProperty(t,"stringExcel",{enumerable:!0,get:function(){return s(c).default}});var l=r(8850);Object.defineProperty(t,"symbol",{enumerable:!0,get:function(){return s(l).default}});var u=r(3429);Object.defineProperty(t,"object",{enumerable:!0,get:function(){return s(u).default}})},6159:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e={}){const{separator:t,decimals:r}=e;return t?r?e=>e.toFixed(r).replace(".",t):e=>`${e}`.replace(".",t):r?e=>e.toFixed(r):e=>`${e}`}},3429:function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(r(9807));t.default=function(e={stringFormatter:(0,n.default)()}){return t=>{if(null===t)return"";let r=JSON.stringify(t);return void 0===r?"":('"'===r[0]&&(r=r.replace(/^"(.+)"$/,"$1")),e.stringFormatter(r))}}},9807:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e={}){const t="string"==typeof e.quote?e.quote:'"',r="string"==typeof e.escapedQuote?e.escapedQuote:`${t}${t}`;if(!t||t===r)return e=>e;const s=new RegExp(t,"g");return e=>(e.includes(t)&&(e=e.replace(s,r)),`${t}${e}${t}`)}},6576:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=new RegExp('"',"g");t.default=function(e){return`"=""${e.replace(r,'""""')}"""`}},6207:function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(r(9807));t.default=function(e={}){const t="string"==typeof e.quote?e.quote:'"',r="string"==typeof e.escapedQuote?e.escapedQuote:`${t}${t}`,s="string"==typeof e.separator?e.separator:",",i="string"==typeof e.eol?e.eol:"\n",o=(0,n.default)({quote:t,escapedQuote:r});return e=>[t,s,i].some((t=>e.includes(t)))?o(e):e}},8850:function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(r(9807));t.default=function(e={stringFormatter:(0,n.default)()}){return t=>e.stringFormatter(t.toString().slice(7,-1))}},9990:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,n)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&s(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.FormatterTypes=void 0;const o=i(r(1776)),a=r(2503);var c;!function(e){e.header="header",e[void 0]="undefined",e.boolean="boolean",e.number="number",e.bigint="bigint",e.string="string",e.symbol="symbol",e.function="function",e.object="object"}(c||(t.FormatterTypes=c={})),t.default=class{constructor(e){this.opts=this.preprocessOpts(e)}preprocessOpts(e){const t=Object.assign({},e);t.fields&&(t.fields=this.preprocessFieldsInfo(t.fields,t.defaultValue)),t.transforms=t.transforms||[];const r=t.formatters&&t.formatters.string||(0,o.string)(),s=(0,o.object)({stringFormatter:r}),n={header:r,undefined:o.default,boolean:o.default,number:(0,o.number)(),bigint:o.default,string:r,symbol:(0,o.symbol)({stringFormatter:r}),function:s,object:s};return t.formatters=Object.assign(Object.assign({},n),t.formatters),t.delimiter=t.delimiter||",",t.eol=t.eol||"\n",t.header=!1!==t.header,t.includeEmptyRows=t.includeEmptyRows||!1,t.withBOM=t.withBOM||!1,t}preprocessFieldsInfo(e,t){return e.map((e=>{if("string"==typeof e)return{label:e,value:r=>(0,a.getProp)(r,e,t)};if("object"==typeof e){const r="default"in e?e.default:t;if("string"==typeof e.value){const t=e.value;return{label:e.label||e.value,value:e=>(0,a.getProp)(e,t,r)}}if("function"==typeof e.value){const t=e.label||e.value.name||"",s={label:t,default:r},n=e.value;return{label:t,value(e){const t=n(e,s);return void 0===t?r:t}}}}throw new Error("Invalid field info option. "+JSON.stringify(e))}))}getHeader(){return(0,a.fastJoin)(this.opts.fields.map((e=>this.opts.formatters.header(e.label))),this.opts.delimiter)}preprocessRow(e){return this.opts.transforms.reduce(((e,t)=>e.map((e=>t(e))).reduce(a.flattenReducer,[])),[e])}processRow(e){if(!e)return;const t=this.opts.fields.map((t=>this.processCell(e,t)));return this.opts.includeEmptyRows||!t.every((e=>""===e))?(0,a.fastJoin)(t,this.opts.delimiter):void 0}processCell(e,t){return this.processValue(t.value(e))}processValue(e){return(0,this.opts.formatters[typeof e])(e)}}},2455:function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(r(9990)),i=r(2503);class o extends n.default{constructor(e){super(e)}parse(e){const t=this.preprocessData(e);this.opts.fields=this.opts.fields||this.preprocessFieldsInfo(t.reduce(((e,t)=>(Object.keys(t).forEach((t=>{e.includes(t)||e.push(t)})),e)),[]),this.opts.defaultValue);const r=this.opts.header?this.getHeader():"",s=this.processData(t);return(this.opts.withBOM?"\ufeff":"")+r+(r&&s?this.opts.eol:"")+s}preprocessData(e){const t=Array.isArray(e)?e:[e];if(!this.opts.fields){if(null==e||0===t.length)throw new Error('Data should not be empty or the "fields" option should be included');if("object"!=typeof t[0])throw new Error('Data items should be objects or the "fields" option should be included')}return 0===this.opts.transforms.length?t:t.map((e=>this.preprocessRow(e))).reduce(i.flattenReducer,[])}processData(e){return(0,i.fastJoin)(e.map((e=>this.processRow(e))).filter((e=>e)),this.opts.eol)}}t.default=o},5183:function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=r(6984),i=s(r(9990));class o extends i.default{constructor(e,t){super(e),this._hasWritten=!1,this.opts.fields&&this.preprocessFieldsInfo(this.opts.fields,this.opts.defaultValue),this.initTokenizer(this.opts,t)}initTokenizer(e,t={}){t.objectMode?this.tokenizer=this.getObjectModeTokenizer():e.ndjson?this.tokenizer=this.getNdJsonTokenizer(t):this.tokenizer=this.getBinaryModeTokenizer(t)}getObjectModeTokenizer(){return{write:e=>this.pushLine(e),end:()=>{this.pushHeaderIfNotWritten(),this.onEnd()}}}configureCallbacks(e,t){e.onToken=t.write.bind(this.tokenParser),e.onError=e=>this.onError(e),e.onEnd=()=>{this.tokenParser.isEnded||this.tokenParser.end()},t.onValue=({value:e})=>this.pushLine(e),t.onError=e=>this.onError(e),t.onEnd=()=>{this.pushHeaderIfNotWritten(),this.onEnd()}}getNdJsonTokenizer(e){const t=new n.Tokenizer(Object.assign(Object.assign({},e),{separator:this.opts.eol}));return this.tokenParser=new n.TokenParser({paths:["$"],keepStack:!1,separator:this.opts.eol}),this.configureCallbacks(t,this.tokenParser),t}getBinaryModeTokenizer(e){const t=new n.Tokenizer(e);return t.onToken=({token:e,value:r})=>{if(e===n.TokenType.LEFT_BRACKET)this.tokenParser=new n.TokenParser({paths:["$.*"],keepStack:!1});else{if(e!==n.TokenType.LEFT_BRACE)return void this.onError(new Error('Data items should be objects or the "fields" option should be included'));this.tokenParser=new n.TokenParser({paths:["$"],keepStack:!1})}this.configureCallbacks(t,this.tokenParser),this.tokenParser.write({token:e,value:r})},t.onError=e=>this.onError(e instanceof n.TokenizerError?new Error("Data should be a valid JSON object or array"):e),t.onEnd=()=>{this.pushHeaderIfNotWritten(),this.onEnd()},t}write(e){this.tokenizer.write(e)}end(){this.tokenizer&&!this.tokenizer.isEnded&&this.tokenizer.end()}pushHeaderIfNotWritten(){this._hasWritten||(this.opts.fields?this.pushHeader():this.onError(new Error('Data should not be empty or the "fields" option should be included')))}pushHeader(){if(this.opts.withBOM&&this.onData("\ufeff"),this.opts.header){const e=this.getHeader();this.onHeader(e),this.onData(e),this._hasWritten=!0}}pushLine(e){const t=this.preprocessRow(e);if(!this._hasWritten){if(!this.opts.fields){if("object"!=typeof t[0])throw new Error('Data items should be objects or the "fields" option should be included');this.opts.fields=this.preprocessFieldsInfo(Object.keys(t[0]),this.opts.defaultValue)}this.pushHeader()}t.forEach((e=>{const t=this.processRow(e);void 0!==t&&(this.onLine(t),this.onData(this._hasWritten?this.opts.eol+t:t),this._hasWritten=!0)}))}onHeader(e){}onLine(e){}onData(e){}onError(e){}onEnd(){}}t.default=o},2518:function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.StreamParser=t.Parser=t.FormatterTypes=t.BaseParser=void 0;var n=r(9990);Object.defineProperty(t,"BaseParser",{enumerable:!0,get:function(){return s(n).default}}),Object.defineProperty(t,"FormatterTypes",{enumerable:!0,get:function(){return n.FormatterTypes}});var i=r(2455);Object.defineProperty(t,"Parser",{enumerable:!0,get:function(){return s(i).default}});var o=r(5183);Object.defineProperty(t,"StreamParser",{enumerable:!0,get:function(){return s(o).default}})},2503:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fastJoin=t.flattenReducer=t.getProp=void 0;const r=RegExp("[^.[\\]]+|\\[(?:([^\"'][^[]*)|([\"'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|$))","g");t.getProp=function(e,t,s){if(t in e){const r=e[t];return void 0===r?s:r}const n=Array.isArray(t)?t:function(e){var t,s,n;const i=[];let o;for(;o=r.exec(e);)i.push(null!==(n=null!==(t=o[3])&&void 0!==t?t:null===(s=o[1])||void 0===s?void 0:s.trim())&&void 0!==n?n:o[0]);return i}(t);let i=e;for(const e of n)if(i=null==i?void 0:i[e],void 0===i)return s;return i},t.flattenReducer=function(e,t){try{return Array.isArray(t)?e.push(...t):e.push(t),e}catch(r){return e.concat(t)}},t.fastJoin=function(e,t){let r=!0;return e.reduce(((e,s)=>(null==s&&(s=""),r?(r=!1,`${s}`):`${e}${t}${s}`)),"")}},6984:function(e,t,r){"use strict";var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,n)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&s(t,e,r);return n(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.TokenType=t.TokenParserMode=t.ParsedElementInfo=t.ParsedTokenInfo=t.JsonTypes=t.utf8=t.TokenParserError=t.TokenParser=t.TokenizerError=t.Tokenizer=t.JSONParser=void 0;var a=r(19);Object.defineProperty(t,"JSONParser",{enumerable:!0,get:function(){return o(a).default}});var c=r(6901);Object.defineProperty(t,"Tokenizer",{enumerable:!0,get:function(){return o(c).default}}),Object.defineProperty(t,"TokenizerError",{enumerable:!0,get:function(){return c.TokenizerError}});var l=r(2798);Object.defineProperty(t,"TokenParser",{enumerable:!0,get:function(){return o(l).default}}),Object.defineProperty(t,"TokenParserError",{enumerable:!0,get:function(){return l.TokenParserError}}),t.utf8=i(r(6602)),t.JsonTypes=i(r(7199)),t.ParsedTokenInfo=i(r(6686)),t.ParsedElementInfo=i(r(3867));var u=r(6346);Object.defineProperty(t,"TokenParserMode",{enumerable:!0,get:function(){return u.TokenParserMode}});var d=r(3341);Object.defineProperty(t,"TokenType",{enumerable:!0,get:function(){return o(d).default}})},19:function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(r(6901)),i=s(r(2798));t.default=class{constructor(e={}){this.tokenizer=new n.default(e),this.tokenParser=new i.default(e),this.tokenizer.onToken=this.tokenParser.write.bind(this.tokenParser),this.tokenizer.onEnd=()=>{this.tokenParser.isEnded||this.tokenParser.end()},this.tokenParser.onError=this.tokenizer.error.bind(this.tokenizer),this.tokenParser.onEnd=()=>{this.tokenizer.isEnded||this.tokenizer.end()}}get isEnded(){return this.tokenizer.isEnded&&this.tokenParser.isEnded}write(e){this.tokenizer.write(e)}end(){this.tokenizer.end()}set onToken(e){this.tokenizer.onToken=t=>{e(t),this.tokenParser.write(t)}}set onValue(e){this.tokenParser.onValue=e}set onError(e){this.tokenizer.onError=e}set onEnd(e){this.tokenParser.onEnd=()=>{this.tokenizer.isEnded||this.tokenizer.end(),e.call(this.tokenParser)}}}},6901:function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.TokenizerError=void 0;const n=r(6602),i=r(6706),o=s(r(3341));var a;function c(e){return["START","ENDED","ERROR","TRUE1","TRUE2","TRUE3","FALSE1","FALSE2","FALSE3","FALSE4","NULL1","NULL2","NULL3","STRING_DEFAULT","STRING_AFTER_BACKSLASH","STRING_UNICODE_DIGIT_1","STRING_UNICODE_DIGIT_2","STRING_UNICODE_DIGIT_3","STRING_UNICODE_DIGIT_4","STRING_INCOMPLETE_CHAR","NUMBER_AFTER_INITIAL_MINUS","NUMBER_AFTER_INITIAL_ZERO","NUMBER_AFTER_INITIAL_NON_ZERO","NUMBER_AFTER_FULL_STOP","NUMBER_AFTER_DECIMAL","NUMBER_AFTER_E","NUMBER_AFTER_E_AND_SIGN","NUMBER_AFTER_E_AND_DIGIT","SEPARATOR","BOM_OR_START","BOM"][e]}!function(e){e[e.START=0]="START",e[e.ENDED=1]="ENDED",e[e.ERROR=2]="ERROR",e[e.TRUE1=3]="TRUE1",e[e.TRUE2=4]="TRUE2",e[e.TRUE3=5]="TRUE3",e[e.FALSE1=6]="FALSE1",e[e.FALSE2=7]="FALSE2",e[e.FALSE3=8]="FALSE3",e[e.FALSE4=9]="FALSE4",e[e.NULL1=10]="NULL1",e[e.NULL2=11]="NULL2",e[e.NULL3=12]="NULL3",e[e.STRING_DEFAULT=13]="STRING_DEFAULT",e[e.STRING_AFTER_BACKSLASH=14]="STRING_AFTER_BACKSLASH",e[e.STRING_UNICODE_DIGIT_1=15]="STRING_UNICODE_DIGIT_1",e[e.STRING_UNICODE_DIGIT_2=16]="STRING_UNICODE_DIGIT_2",e[e.STRING_UNICODE_DIGIT_3=17]="STRING_UNICODE_DIGIT_3",e[e.STRING_UNICODE_DIGIT_4=18]="STRING_UNICODE_DIGIT_4",e[e.STRING_INCOMPLETE_CHAR=19]="STRING_INCOMPLETE_CHAR",e[e.NUMBER_AFTER_INITIAL_MINUS=20]="NUMBER_AFTER_INITIAL_MINUS",e[e.NUMBER_AFTER_INITIAL_ZERO=21]="NUMBER_AFTER_INITIAL_ZERO",e[e.NUMBER_AFTER_INITIAL_NON_ZERO=22]="NUMBER_AFTER_INITIAL_NON_ZERO",e[e.NUMBER_AFTER_FULL_STOP=23]="NUMBER_AFTER_FULL_STOP",e[e.NUMBER_AFTER_DECIMAL=24]="NUMBER_AFTER_DECIMAL",e[e.NUMBER_AFTER_E=25]="NUMBER_AFTER_E",e[e.NUMBER_AFTER_E_AND_SIGN=26]="NUMBER_AFTER_E_AND_SIGN",e[e.NUMBER_AFTER_E_AND_DIGIT=27]="NUMBER_AFTER_E_AND_DIGIT",e[e.SEPARATOR=28]="SEPARATOR",e[e.BOM_OR_START=29]="BOM_OR_START",e[e.BOM=30]="BOM"}(a||(a={}));const l={stringBufferSize:0,numberBufferSize:0,separator:void 0,emitPartialTokens:!1};class u extends Error{constructor(e){super(e),Object.setPrototypeOf(this,u.prototype)}}t.TokenizerError=u,t.default=class{constructor(e){this.state=29,this.bomIndex=0,this.separatorIndex=0,this.bytes_remaining=0,this.bytes_in_sequence=0,this.char_split_buffer=new Uint8Array(4),this.encoder=new TextEncoder,this.offset=-1,e=Object.assign(Object.assign({},l),e),this.emitPartialTokens=!0===e.emitPartialTokens,this.bufferedString=e.stringBufferSize&&e.stringBufferSize>4?new i.BufferedString(e.stringBufferSize):new i.NonBufferedString,this.bufferedNumber=e.numberBufferSize&&e.numberBufferSize>0?new i.BufferedString(e.numberBufferSize):new i.NonBufferedString,this.separator=e.separator,this.separatorBytes=e.separator?this.encoder.encode(e.separator):void 0}get isEnded(){return 1===this.state}write(e){try{let t;if(e instanceof Uint8Array)t=e;else if("string"==typeof e)t=this.encoder.encode(e);else if(Array.isArray(e))t=Uint8Array.from(e);else{if(!ArrayBuffer.isView(e))throw new TypeError("Unexpected type. The `write` function only accepts Arrays, TypedArrays and Strings.");t=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}for(let r=0;r<t.length;r+=1){const s=t[r];switch(this.state){case 29:if(e instanceof Uint8Array&&239===s){this.bom=[239,187,191],this.bomIndex+=1,this.state=30;continue}if(e instanceof Uint16Array){if(254===s){this.bom=[254,255],this.bomIndex+=1,this.state=30;continue}if(255===s){this.bom=[255,254],this.bomIndex+=1,this.state=30;continue}}if(e instanceof Uint32Array){if(0===s){this.bom=[0,0,254,255],this.bomIndex+=1,this.state=30;continue}if(255===s){this.bom=[255,254,0,0],this.bomIndex+=1,this.state=30;continue}}case 0:if(this.offset+=1,this.separatorBytes&&s===this.separatorBytes[0]){if(1===this.separatorBytes.length){this.state=0,this.onToken({token:o.default.SEPARATOR,value:this.separator,offset:this.offset+this.separatorBytes.length-1});continue}this.state=28;continue}if(32===s||10===s||13===s||9===s)continue;if(123===s){this.onToken({token:o.default.LEFT_BRACE,value:"{",offset:this.offset});continue}if(125===s){this.onToken({token:o.default.RIGHT_BRACE,value:"}",offset:this.offset});continue}if(91===s){this.onToken({token:o.default.LEFT_BRACKET,value:"[",offset:this.offset});continue}if(93===s){this.onToken({token:o.default.RIGHT_BRACKET,value:"]",offset:this.offset});continue}if(58===s){this.onToken({token:o.default.COLON,value:":",offset:this.offset});continue}if(44===s){this.onToken({token:o.default.COMMA,value:",",offset:this.offset});continue}if(116===s){this.state=3;continue}if(102===s){this.state=6;continue}if(110===s){this.state=10;continue}if(34===s){this.bufferedString.reset(),this.state=13;continue}if(s>=49&&s<=57){this.bufferedNumber.reset(),this.bufferedNumber.appendChar(s),this.state=22;continue}if(48===s){this.bufferedNumber.reset(),this.bufferedNumber.appendChar(s),this.state=21;continue}if(45===s){this.bufferedNumber.reset(),this.bufferedNumber.appendChar(s),this.state=20;continue}break;case 13:if(34===s){const e=this.bufferedString.toString();this.state=0,this.onToken({token:o.default.STRING,value:e,offset:this.offset}),this.offset+=this.bufferedString.byteLength+1;continue}if(92===s){this.state=14;continue}if(s>=128){if(this.bytes_in_sequence=s>=194&&s<=223?2:s<=239?3:4,this.bytes_in_sequence<=t.length-r){this.bufferedString.appendBuf(t,r,r+this.bytes_in_sequence),r+=this.bytes_in_sequence-1;continue}this.bytes_remaining=r+this.bytes_in_sequence-t.length,this.char_split_buffer.set(t.subarray(r)),r=t.length-1,this.state=19;continue}if(s>=32){this.bufferedString.appendChar(s);continue}break;case 19:this.char_split_buffer.set(t.subarray(r,r+this.bytes_remaining),this.bytes_in_sequence-this.bytes_remaining),this.bufferedString.appendBuf(this.char_split_buffer,0,this.bytes_in_sequence),r=this.bytes_remaining-1,this.state=13;continue;case 14:const i=n.escapedSequences[s];if(i){this.bufferedString.appendChar(i),this.state=13;continue}if(117===s){this.unicode="",this.state=15;continue}break;case 15:case 16:case 17:if(s>=48&&s<=57||s>=65&&s<=70||s>=97&&s<=102){this.unicode+=String.fromCharCode(s),this.state+=1;continue}break;case 18:if(s>=48&&s<=57||s>=65&&s<=70||s>=97&&s<=102){const e=parseInt(this.unicode+String.fromCharCode(s),16);void 0===this.highSurrogate?e>=55296&&e<=56319?this.highSurrogate=e:this.bufferedString.appendBuf(this.encoder.encode(String.fromCharCode(e))):(e>=56320&&e<=57343?this.bufferedString.appendBuf(this.encoder.encode(String.fromCharCode(this.highSurrogate,e))):this.bufferedString.appendBuf(this.encoder.encode(String.fromCharCode(this.highSurrogate))),this.highSurrogate=void 0),this.state=13;continue}break;case 20:if(48===s){this.bufferedNumber.appendChar(s),this.state=21;continue}if(s>=49&&s<=57){this.bufferedNumber.appendChar(s),this.state=22;continue}break;case 21:if(46===s){this.bufferedNumber.appendChar(s),this.state=23;continue}if(101===s||69===s){this.bufferedNumber.appendChar(s),this.state=25;continue}r-=1,this.state=0,this.emitNumber();continue;case 22:if(s>=48&&s<=57){this.bufferedNumber.appendChar(s);continue}if(46===s){this.bufferedNumber.appendChar(s),this.state=23;continue}if(101===s||69===s){this.bufferedNumber.appendChar(s),this.state=25;continue}r-=1,this.state=0,this.emitNumber();continue;case 23:if(s>=48&&s<=57){this.bufferedNumber.appendChar(s),this.state=24;continue}break;case 24:if(s>=48&&s<=57){this.bufferedNumber.appendChar(s);continue}if(101===s||69===s){this.bufferedNumber.appendChar(s),this.state=25;continue}r-=1,this.state=0,this.emitNumber();continue;case 25:if(43===s||45===s){this.bufferedNumber.appendChar(s),this.state=26;continue}case 26:if(s>=48&&s<=57){this.bufferedNumber.appendChar(s),this.state=27;continue}break;case 27:if(s>=48&&s<=57){this.bufferedNumber.appendChar(s);continue}r-=1,this.state=0,this.emitNumber();continue;case 3:if(114===s){this.state=4;continue}break;case 4:if(117===s){this.state=5;continue}break;case 5:if(101===s){this.state=0,this.onToken({token:o.default.TRUE,value:!0,offset:this.offset}),this.offset+=3;continue}break;case 6:if(97===s){this.state=7;continue}break;case 7:if(108===s){this.state=8;continue}break;case 8:if(115===s){this.state=9;continue}break;case 9:if(101===s){this.state=0,this.onToken({token:o.default.FALSE,value:!1,offset:this.offset}),this.offset+=4;continue}break;case 10:if(117===s){this.state=11;continue}break;case 11:if(108===s){this.state=12;continue}break;case 12:if(108===s){this.state=0,this.onToken({token:o.default.NULL,value:null,offset:this.offset}),this.offset+=3;continue}break;case 28:if(this.separatorIndex+=1,!this.separatorBytes||s!==this.separatorBytes[this.separatorIndex])break;this.separatorIndex===this.separatorBytes.length-1&&(this.state=0,this.onToken({token:o.default.SEPARATOR,value:this.separator,offset:this.offset+this.separatorIndex}),this.separatorIndex=0);continue;case 30:if(s===this.bom[this.bomIndex]){if(this.bomIndex===this.bom.length-1){this.state=0,this.bom=void 0,this.bomIndex=0;continue}this.bomIndex+=1;continue}break;case 1:if(32===s||10===s||13===s||9===s)continue}throw new u(`Unexpected "${String.fromCharCode(s)}" at position "${r}" in state ${c(this.state)}`)}if(this.emitPartialTokens)switch(this.state){case 3:case 4:case 5:this.onToken({token:o.default.TRUE,value:!0,offset:this.offset,partial:!0});break;case 6:case 7:case 8:case 9:this.onToken({token:o.default.FALSE,value:!1,offset:this.offset,partial:!0});break;case 10:case 11:case 12:this.onToken({token:o.default.NULL,value:null,offset:this.offset,partial:!0});break;case 13:{const e=this.bufferedString.toString();this.onToken({token:o.default.STRING,value:e,offset:this.offset,partial:!0});break}case 21:case 22:case 24:case 27:try{this.onToken({token:o.default.NUMBER,value:this.parseNumber(this.bufferedNumber.toString()),offset:this.offset,partial:!0})}catch(e){}}}catch(e){this.error(e)}}emitNumber(){this.onToken({token:o.default.NUMBER,value:this.parseNumber(this.bufferedNumber.toString()),offset:this.offset}),this.offset+=this.bufferedNumber.byteLength-1}parseNumber(e){return Number(e)}error(e){1!==this.state&&(this.state=2),this.onError(e)}end(){switch(this.state){case 21:case 22:case 24:case 27:this.state=1,this.emitNumber(),this.onEnd();break;case 29:case 0:case 2:case 28:this.state=1,this.onEnd();break;default:this.error(new u(`Tokenizer ended in the middle of a token (state: ${c(this.state)}). Either not all the data was received or the data was invalid.`))}}onToken(e){throw new u('Can\'t emit tokens before the "onToken" callback has been set up.')}onError(e){throw e}onEnd(){}}},2798:function(e,t,r){"use strict";var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.TokenParserError=void 0;const n=s(r(3341));var i;function o(e){return["VALUE","KEY","COLON","COMMA","ENDED","ERROR","SEPARATOR"][e]}!function(e){e[e.VALUE=0]="VALUE",e[e.KEY=1]="KEY",e[e.COLON=2]="COLON",e[e.COMMA=3]="COMMA",e[e.ENDED=4]="ENDED",e[e.ERROR=5]="ERROR",e[e.SEPARATOR=6]="SEPARATOR"}(i||(i={}));const a={paths:void 0,keepStack:!0,separator:void 0,emitPartialValues:!1};class c extends Error{constructor(e){super(e),Object.setPrototypeOf(this,c.prototype)}}t.TokenParserError=c,t.default=class{constructor(e){this.state=0,this.mode=void 0,this.key=void 0,this.value=void 0,this.stack=[],(e=Object.assign(Object.assign({},a),e)).paths&&(this.paths=e.paths.map((e=>{if(void 0===e||"$*"===e)return;if(!e.startsWith("$"))throw new c(`Invalid selector "${e}". Should start with "$".`);const t=e.split(".").slice(1);if(t.includes(""))throw new c(`Invalid selector "${e}". ".." syntax not supported.`);return t}))),this.keepStack=e.keepStack||!1,this.separator=e.separator,e.emitPartialValues||(this.emitPartial=()=>{})}shouldEmit(){return!this.paths||this.paths.some((e=>{var t;if(void 0===e)return!0;if(e.length!==this.stack.length)return!1;for(let t=0;t<e.length-1;t++){const r=e[t],s=this.stack[t+1].key;if("*"!==r&&r!==s)return!1}const r=e[e.length-1];return"*"===r||r===(null===(t=this.key)||void 0===t?void 0:t.toString())}))}push(){this.stack.push({key:this.key,value:this.value,mode:this.mode,emit:this.shouldEmit()})}pop(){const e=this.value;let t;({key:this.key,value:this.value,mode:this.mode,emit:t}=this.stack.pop()),this.state=void 0!==this.mode?3:0,this.emit(e,t)}emit(e,t){!this.keepStack&&this.value&&this.stack.every((e=>!e.emit))&&delete this.value[this.key],t&&this.onValue({value:e,key:this.key,parent:this.value,stack:this.stack}),0===this.stack.length&&(this.separator?this.state=6:void 0===this.separator&&this.end())}emitPartial(e){this.shouldEmit()&&(1!==this.state?this.onValue({value:e,key:this.key,parent:this.value,stack:this.stack,partial:!0}):this.onValue({value:void 0,key:e,parent:this.value,stack:this.stack,partial:!0}))}get isEnded(){return 4===this.state}write({token:e,value:t,partial:r}){try{if(r)return void this.emitPartial(t);if(0===this.state){if(e===n.default.STRING||e===n.default.NUMBER||e===n.default.TRUE||e===n.default.FALSE||e===n.default.NULL)return 0===this.mode?(this.value[this.key]=t,this.state=3):1===this.mode&&(this.value.push(t),this.state=3),void this.emit(t,this.shouldEmit());if(e===n.default.LEFT_BRACE){if(this.push(),0===this.mode)this.value=this.value[this.key]={};else if(1===this.mode){const e={};this.value.push(e),this.value=e}else this.value={};return this.mode=0,this.state=1,this.key=void 0,void this.emitPartial()}if(e===n.default.LEFT_BRACKET){if(this.push(),0===this.mode)this.value=this.value[this.key]=[];else if(1===this.mode){const e=[];this.value.push(e),this.value=e}else this.value=[];return this.mode=1,this.state=0,this.key=0,void this.emitPartial()}if(1===this.mode&&e===n.default.RIGHT_BRACKET&&0===this.value.length)return void this.pop()}if(1===this.state){if(e===n.default.STRING)return this.key=t,this.state=2,void this.emitPartial();if(e===n.default.RIGHT_BRACE&&0===Object.keys(this.value).length)return void this.pop()}if(2===this.state&&e===n.default.COLON)return void(this.state=0);if(3===this.state){if(e===n.default.COMMA){if(1===this.mode)return this.state=0,void(this.key+=1);if(0===this.mode)return void(this.state=1)}if(e===n.default.RIGHT_BRACE&&0===this.mode||e===n.default.RIGHT_BRACKET&&1===this.mode)return void this.pop()}if(6===this.state&&e===n.default.SEPARATOR&&t===this.separator)return void(this.state=0);throw new c(`Unexpected ${n.default[e]} (${JSON.stringify(t)}) in state ${o(this.state)}`)}catch(e){this.error(e)}}error(e){4!==this.state&&(this.state=5),this.onError(e)}end(){0!==this.state&&6!==this.state||this.stack.length>0?this.error(new Error(`Parser ended in mid-parsing (state: ${o(this.state)}). Either not all the data was received or the data was invalid.`)):(this.state=4,this.onEnd())}onValue(e){throw new c('Can\'t emit data before the "onValue" callback has been set up.')}onError(e){throw e}onEnd(){}}},6706:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BufferedString=t.NonBufferedString=void 0,t.NonBufferedString=class{constructor(){this.decoder=new TextDecoder("utf-8"),this.strings=[],this.byteLength=0}appendChar(e){this.strings.push(String.fromCharCode(e)),this.byteLength+=1}appendBuf(e,t=0,r=e.length){this.strings.push(this.decoder.decode(e.subarray(t,r))),this.byteLength+=r-t}reset(){this.strings=[],this.byteLength=0}toString(){return this.strings.join("")}},t.BufferedString=class{constructor(e){this.decoder=new TextDecoder("utf-8"),this.bufferOffset=0,this.string="",this.byteLength=0,this.buffer=new Uint8Array(e)}appendChar(e){this.bufferOffset>=this.buffer.length&&this.flushStringBuffer(),this.buffer[this.bufferOffset++]=e,this.byteLength+=1}appendBuf(e,t=0,r=e.length){const s=r-t;this.bufferOffset+s>this.buffer.length&&this.flushStringBuffer(),this.buffer.set(e.subarray(t,r),this.bufferOffset),this.bufferOffset+=s,this.byteLength+=s}flushStringBuffer(){this.string+=this.decoder.decode(this.buffer.subarray(0,this.bufferOffset)),this.bufferOffset=0}reset(){this.string="",this.bufferOffset=0,this.byteLength=0}toString(){return this.flushStringBuffer(),this.string}}},7199:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},3867:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},6686:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},6346:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.TokenParserMode=void 0,function(e){e[e.OBJECT=0]="OBJECT",e[e.ARRAY=1]="ARRAY"}(r||(t.TokenParserMode=r={}))},3341:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.LEFT_BRACE=0]="LEFT_BRACE",e[e.RIGHT_BRACE=1]="RIGHT_BRACE",e[e.LEFT_BRACKET=2]="LEFT_BRACKET",e[e.RIGHT_BRACKET=3]="RIGHT_BRACKET",e[e.COLON=4]="COLON",e[e.COMMA=5]="COMMA",e[e.TRUE=6]="TRUE",e[e.FALSE=7]="FALSE",e[e.NULL=8]="NULL",e[e.STRING=9]="STRING",e[e.NUMBER=10]="NUMBER",e[e.SEPARATOR=11]="SEPARATOR"}(r||(r={})),t.default=r},6602:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.escapedSequences=t.charset=void 0,function(e){e[e.BACKSPACE=8]="BACKSPACE",e[e.FORM_FEED=12]="FORM_FEED",e[e.NEWLINE=10]="NEWLINE",e[e.CARRIAGE_RETURN=13]="CARRIAGE_RETURN",e[e.TAB=9]="TAB",e[e.SPACE=32]="SPACE",e[e.EXCLAMATION_MARK=33]="EXCLAMATION_MARK",e[e.QUOTATION_MARK=34]="QUOTATION_MARK",e[e.NUMBER_SIGN=35]="NUMBER_SIGN",e[e.DOLLAR_SIGN=36]="DOLLAR_SIGN",e[e.PERCENT_SIGN=37]="PERCENT_SIGN",e[e.AMPERSAND=38]="AMPERSAND",e[e.APOSTROPHE=39]="APOSTROPHE",e[e.LEFT_PARENTHESIS=40]="LEFT_PARENTHESIS",e[e.RIGHT_PARENTHESIS=41]="RIGHT_PARENTHESIS",e[e.ASTERISK=42]="ASTERISK",e[e.PLUS_SIGN=43]="PLUS_SIGN",e[e.COMMA=44]="COMMA",e[e.HYPHEN_MINUS=45]="HYPHEN_MINUS",e[e.FULL_STOP=46]="FULL_STOP",e[e.SOLIDUS=47]="SOLIDUS",e[e.DIGIT_ZERO=48]="DIGIT_ZERO",e[e.DIGIT_ONE=49]="DIGIT_ONE",e[e.DIGIT_TWO=50]="DIGIT_TWO",e[e.DIGIT_THREE=51]="DIGIT_THREE",e[e.DIGIT_FOUR=52]="DIGIT_FOUR",e[e.DIGIT_FIVE=53]="DIGIT_FIVE",e[e.DIGIT_SIX=54]="DIGIT_SIX",e[e.DIGIT_SEVEN=55]="DIGIT_SEVEN",e[e.DIGIT_EIGHT=56]="DIGIT_EIGHT",e[e.DIGIT_NINE=57]="DIGIT_NINE",e[e.COLON=58]="COLON",e[e.SEMICOLON=59]="SEMICOLON",e[e.LESS_THAN_SIGN=60]="LESS_THAN_SIGN",e[e.EQUALS_SIGN=61]="EQUALS_SIGN",e[e.GREATER_THAN_SIGN=62]="GREATER_THAN_SIGN",e[e.QUESTION_MARK=63]="QUESTION_MARK",e[e.COMMERCIAL_AT=64]="COMMERCIAL_AT",e[e.LATIN_CAPITAL_LETTER_A=65]="LATIN_CAPITAL_LETTER_A",e[e.LATIN_CAPITAL_LETTER_B=66]="LATIN_CAPITAL_LETTER_B",e[e.LATIN_CAPITAL_LETTER_C=67]="LATIN_CAPITAL_LETTER_C",e[e.LATIN_CAPITAL_LETTER_D=68]="LATIN_CAPITAL_LETTER_D",e[e.LATIN_CAPITAL_LETTER_E=69]="LATIN_CAPITAL_LETTER_E",e[e.LATIN_CAPITAL_LETTER_F=70]="LATIN_CAPITAL_LETTER_F",e[e.LATIN_CAPITAL_LETTER_G=71]="LATIN_CAPITAL_LETTER_G",e[e.LATIN_CAPITAL_LETTER_H=72]="LATIN_CAPITAL_LETTER_H",e[e.LATIN_CAPITAL_LETTER_I=73]="LATIN_CAPITAL_LETTER_I",e[e.LATIN_CAPITAL_LETTER_J=74]="LATIN_CAPITAL_LETTER_J",e[e.LATIN_CAPITAL_LETTER_K=75]="LATIN_CAPITAL_LETTER_K",e[e.LATIN_CAPITAL_LETTER_L=76]="LATIN_CAPITAL_LETTER_L",e[e.LATIN_CAPITAL_LETTER_M=77]="LATIN_CAPITAL_LETTER_M",e[e.LATIN_CAPITAL_LETTER_N=78]="LATIN_CAPITAL_LETTER_N",e[e.LATIN_CAPITAL_LETTER_O=79]="LATIN_CAPITAL_LETTER_O",e[e.LATIN_CAPITAL_LETTER_P=80]="LATIN_CAPITAL_LETTER_P",e[e.LATIN_CAPITAL_LETTER_Q=81]="LATIN_CAPITAL_LETTER_Q",e[e.LATIN_CAPITAL_LETTER_R=82]="LATIN_CAPITAL_LETTER_R",e[e.LATIN_CAPITAL_LETTER_S=83]="LATIN_CAPITAL_LETTER_S",e[e.LATIN_CAPITAL_LETTER_T=84]="LATIN_CAPITAL_LETTER_T",e[e.LATIN_CAPITAL_LETTER_U=85]="LATIN_CAPITAL_LETTER_U",e[e.LATIN_CAPITAL_LETTER_V=86]="LATIN_CAPITAL_LETTER_V",e[e.LATIN_CAPITAL_LETTER_W=87]="LATIN_CAPITAL_LETTER_W",e[e.LATIN_CAPITAL_LETTER_X=88]="LATIN_CAPITAL_LETTER_X",e[e.LATIN_CAPITAL_LETTER_Y=89]="LATIN_CAPITAL_LETTER_Y",e[e.LATIN_CAPITAL_LETTER_Z=90]="LATIN_CAPITAL_LETTER_Z",e[e.LEFT_SQUARE_BRACKET=91]="LEFT_SQUARE_BRACKET",e[e.REVERSE_SOLIDUS=92]="REVERSE_SOLIDUS",e[e.RIGHT_SQUARE_BRACKET=93]="RIGHT_SQUARE_BRACKET",e[e.CIRCUMFLEX_ACCENT=94]="CIRCUMFLEX_ACCENT",e[e.LOW_LINE=95]="LOW_LINE",e[e.GRAVE_ACCENT=96]="GRAVE_ACCENT",e[e.LATIN_SMALL_LETTER_A=97]="LATIN_SMALL_LETTER_A",e[e.LATIN_SMALL_LETTER_B=98]="LATIN_SMALL_LETTER_B",e[e.LATIN_SMALL_LETTER_C=99]="LATIN_SMALL_LETTER_C",e[e.LATIN_SMALL_LETTER_D=100]="LATIN_SMALL_LETTER_D",e[e.LATIN_SMALL_LETTER_E=101]="LATIN_SMALL_LETTER_E",e[e.LATIN_SMALL_LETTER_F=102]="LATIN_SMALL_LETTER_F",e[e.LATIN_SMALL_LETTER_G=103]="LATIN_SMALL_LETTER_G",e[e.LATIN_SMALL_LETTER_H=104]="LATIN_SMALL_LETTER_H",e[e.LATIN_SMALL_LETTER_I=105]="LATIN_SMALL_LETTER_I",e[e.LATIN_SMALL_LETTER_J=106]="LATIN_SMALL_LETTER_J",e[e.LATIN_SMALL_LETTER_K=107]="LATIN_SMALL_LETTER_K",e[e.LATIN_SMALL_LETTER_L=108]="LATIN_SMALL_LETTER_L",e[e.LATIN_SMALL_LETTER_M=109]="LATIN_SMALL_LETTER_M",e[e.LATIN_SMALL_LETTER_N=110]="LATIN_SMALL_LETTER_N",e[e.LATIN_SMALL_LETTER_O=111]="LATIN_SMALL_LETTER_O",e[e.LATIN_SMALL_LETTER_P=112]="LATIN_SMALL_LETTER_P",e[e.LATIN_SMALL_LETTER_Q=113]="LATIN_SMALL_LETTER_Q",e[e.LATIN_SMALL_LETTER_R=114]="LATIN_SMALL_LETTER_R",e[e.LATIN_SMALL_LETTER_S=115]="LATIN_SMALL_LETTER_S",e[e.LATIN_SMALL_LETTER_T=116]="LATIN_SMALL_LETTER_T",e[e.LATIN_SMALL_LETTER_U=117]="LATIN_SMALL_LETTER_U",e[e.LATIN_SMALL_LETTER_V=118]="LATIN_SMALL_LETTER_V",e[e.LATIN_SMALL_LETTER_W=119]="LATIN_SMALL_LETTER_W",e[e.LATIN_SMALL_LETTER_X=120]="LATIN_SMALL_LETTER_X",e[e.LATIN_SMALL_LETTER_Y=121]="LATIN_SMALL_LETTER_Y",e[e.LATIN_SMALL_LETTER_Z=122]="LATIN_SMALL_LETTER_Z",e[e.LEFT_CURLY_BRACKET=123]="LEFT_CURLY_BRACKET",e[e.VERTICAL_LINE=124]="VERTICAL_LINE",e[e.RIGHT_CURLY_BRACKET=125]="RIGHT_CURLY_BRACKET",e[e.TILDE=126]="TILDE"}(r||(t.charset=r={})),t.escapedSequences={34:34,92:92,47:47,98:8,102:12,110:10,114:13,116:9}},1635:(e,t,r)=>{"use strict";r.r(t),r.d(t,{__addDisposableResource:()=>x,__assign:()=>i,__asyncDelegator:()=>S,__asyncGenerator:()=>A,__asyncValues:()=>k,__await:()=>E,__awaiter:()=>f,__classPrivateFieldGet:()=>R,__classPrivateFieldIn:()=>j,__classPrivateFieldSet:()=>C,__createBinding:()=>g,__decorate:()=>a,__disposeResources:()=>D,__esDecorate:()=>l,__exportStar:()=>y,__extends:()=>n,__generator:()=>b,__importDefault:()=>N,__importStar:()=>P,__makeTemplateObject:()=>w,__metadata:()=>p,__param:()=>c,__propKey:()=>d,__read:()=>_,__rest:()=>o,__rewriteRelativeImportExtension:()=>V,__runInitializers:()=>u,__setFunctionName:()=>h,__spread:()=>v,__spreadArray:()=>T,__spreadArrays:()=>I,__values:()=>m,default:()=>$});var s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},s(e,t)};function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var i=function(){return i=Object.assign||function(e){for(var t,r=1,s=arguments.length;r<s;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e},i.apply(this,arguments)};function o(e,t){var r={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(r[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(s=Object.getOwnPropertySymbols(e);n<s.length;n++)t.indexOf(s[n])<0&&Object.prototype.propertyIsEnumerable.call(e,s[n])&&(r[s[n]]=e[s[n]])}return r}function a(e,t,r,s){var n,i=arguments.length,o=i<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(o=(i<3?n(o):i>3?n(t,r,o):n(t,r))||o);return i>3&&o&&Object.defineProperty(t,r,o),o}function c(e,t){return function(r,s){t(r,s,e)}}function l(e,t,r,s,n,i){function o(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var a,c=s.kind,l="getter"===c?"get":"setter"===c?"set":"value",u=!t&&e?s.static?e:e.prototype:null,d=t||(u?Object.getOwnPropertyDescriptor(u,s.name):{}),h=!1,p=r.length-1;p>=0;p--){var f={};for(var b in s)f[b]="access"===b?{}:s[b];for(var b in s.access)f.access[b]=s.access[b];f.addInitializer=function(e){if(h)throw new TypeError("Cannot add initializers after decoration has completed");i.push(o(e||null))};var g=(0,r[p])("accessor"===c?{get:d.get,set:d.set}:d[l],f);if("accessor"===c){if(void 0===g)continue;if(null===g||"object"!=typeof g)throw new TypeError("Object expected");(a=o(g.get))&&(d.get=a),(a=o(g.set))&&(d.set=a),(a=o(g.init))&&n.unshift(a)}else(a=o(g))&&("field"===c?n.unshift(a):d[l]=a)}u&&Object.defineProperty(u,s.name,d),h=!0}function u(e,t,r){for(var s=arguments.length>2,n=0;n<t.length;n++)r=s?t[n].call(e,r):t[n].call(e);return s?r:void 0}function d(e){return"symbol"==typeof e?e:"".concat(e)}function h(e,t,r){return"symbol"==typeof t&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:r?"".concat(r," ",t):t})}function p(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function f(e,t,r,s){return new(r||(r=Promise))((function(n,i){function o(e){try{c(s.next(e))}catch(e){i(e)}}function a(e){try{c(s.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,a)}c((s=s.apply(e,t||[])).next())}))}function b(e,t){var r,s,n,i={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=a(0),o.throw=a(1),o.return=a(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(c){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(i=0)),i;)try{if(r=1,s&&(n=2&a[0]?s.return:a[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,a[1])).done)return n;switch(s=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,s=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((n=(n=i.trys).length>0&&n[n.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){i.label=a[1];break}if(6===a[0]&&i.label<n[1]){i.label=n[1],n=a;break}if(n&&i.label<n[2]){i.label=n[2],i.ops.push(a);break}n[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],s=0}finally{r=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}var g=Object.create?function(e,t,r,s){void 0===s&&(s=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,n)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]};function y(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||g(t,e,r)}function m(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],s=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&s>=e.length&&(e=void 0),{value:e&&e[s++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function _(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var s,n,i=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(s=i.next()).done;)o.push(s.value)}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}return o}function v(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(_(arguments[t]));return e}function I(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var s=Array(e),n=0;for(t=0;t<r;t++)for(var i=arguments[t],o=0,a=i.length;o<a;o++,n++)s[n]=i[o];return s}function T(e,t,r){if(r||2===arguments.length)for(var s,n=0,i=t.length;n<i;n++)!s&&n in t||(s||(s=Array.prototype.slice.call(t,0,n)),s[n]=t[n]);return e.concat(s||Array.prototype.slice.call(t))}function E(e){return this instanceof E?(this.v=e,this):new E(e)}function A(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var s,n=r.apply(e,t||[]),i=[];return s=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),o("next"),o("throw"),o("return",(function(e){return function(t){return Promise.resolve(t).then(e,l)}})),s[Symbol.asyncIterator]=function(){return this},s;function o(e,t){n[e]&&(s[e]=function(t){return new Promise((function(r,s){i.push([e,t,r,s])>1||a(e,t)}))},t&&(s[e]=t(s[e])))}function a(e,t){try{(r=n[e](t)).value instanceof E?Promise.resolve(r.value.v).then(c,l):u(i[0][2],r)}catch(e){u(i[0][3],e)}var r}function c(e){a("next",e)}function l(e){a("throw",e)}function u(e,t){e(t),i.shift(),i.length&&a(i[0][0],i[0][1])}}function S(e){var t,r;return t={},s("next"),s("throw",(function(e){throw e})),s("return"),t[Symbol.iterator]=function(){return this},t;function s(s,n){t[s]=e[s]?function(t){return(r=!r)?{value:E(e[s](t)),done:!1}:n?n(t):t}:n}}function k(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=m(e),t={},s("next"),s("throw"),s("return"),t[Symbol.asyncIterator]=function(){return this},t);function s(r){t[r]=e[r]&&function(t){return new Promise((function(s,n){!function(e,t,r,s){Promise.resolve(s).then((function(t){e({value:t,done:r})}),t)}(s,n,(t=e[r](t)).done,t.value)}))}}}function w(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var L=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t},O=function(e){return O=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},O(e)};function P(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=O(e),s=0;s<r.length;s++)"default"!==r[s]&&g(t,e,r[s]);return L(t,e),t}function N(e){return e&&e.__esModule?e:{default:e}}function R(e,t,r,s){if("a"===r&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?s:"a"===r?s.call(e):s?s.value:t.get(e)}function C(e,t,r,s,n){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?n.call(e,r):n?n.value=r:t.set(e,r),r}function j(e,t){if(null===t||"object"!=typeof t&&"function"!=typeof t)throw new TypeError("Cannot use 'in' operator on non-object");return"function"==typeof e?t===e:e.has(t)}function x(e,t,r){if(null!=t){if("object"!=typeof t&&"function"!=typeof t)throw new TypeError("Object expected.");var s,n;if(r){if(!Symbol.asyncDispose)throw new TypeError("Symbol.asyncDispose is not defined.");s=t[Symbol.asyncDispose]}if(void 0===s){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");s=t[Symbol.dispose],r&&(n=s)}if("function"!=typeof s)throw new TypeError("Object not disposable.");n&&(s=function(){try{n.call(this)}catch(e){return Promise.reject(e)}}),e.stack.push({value:t,dispose:s,async:r})}else r&&e.stack.push({async:!0});return t}var M="function"==typeof SuppressedError?SuppressedError:function(e,t,r){var s=new Error(r);return s.name="SuppressedError",s.error=e,s.suppressed=t,s};function D(e){function t(t){e.error=e.hasError?new M(t,e.error,"An error was suppressed during disposal."):t,e.hasError=!0}var r,s=0;return function n(){for(;r=e.stack.pop();)try{if(!r.async&&1===s)return s=0,e.stack.push(r),Promise.resolve().then(n);if(r.dispose){var i=r.dispose.call(r.value);if(r.async)return s|=2,Promise.resolve(i).then(n,(function(e){return t(e),n()}))}else s|=1}catch(e){t(e)}if(1===s)return e.hasError?Promise.reject(e.error):Promise.resolve();if(e.hasError)throw e.error}()}function V(e,t){return"string"==typeof e&&/^\.\.?\//.test(e)?e.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,(function(e,r,s,n,i){return r?t?".jsx":".js":!s||n&&i?s+n+"."+i.toLowerCase()+"js":e})):e}const $={__extends:n,__assign:i,__rest:o,__decorate:a,__param:c,__esDecorate:l,__runInitializers:u,__propKey:d,__setFunctionName:h,__metadata:p,__awaiter:f,__generator:b,__createBinding:g,__exportStar:y,__values:m,__read:_,__spread:v,__spreadArrays:I,__spreadArray:T,__await:E,__asyncGenerator:A,__asyncDelegator:S,__asyncValues:k,__makeTemplateObject:w,__importStar:P,__importDefault:N,__classPrivateFieldGet:R,__classPrivateFieldSet:C,__classPrivateFieldIn:j,__addDisposableResource:x,__disposeResources:D,__rewriteRelativeImportExtension:V}}},t={};function r(s){var n=t[s];if(void 0!==n)return n.exports;var i=t[s]={exports:{}};return e[s].call(i.exports,i,i.exports,r),i.exports}r.d=(e,t)=>{for(var s in t)r.o(t,s)&&!r.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r(7806)})();