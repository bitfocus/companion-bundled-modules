"use strict";exports.id=122,exports.ids=[122],exports.modules={9122:(e,n,t)=>{t.r(n),t.d(n,{initWebSocketHandle:()=>g,messageReceived:()=>o,parseStatus:()=>s});var a=t(6278),i=t(7699);function s(e,n){null!=n.meetingUpdate.meetingState&&(e.isMuted=n.meetingUpdate.meetingState.isMuted,e.isVideoOn=n.meetingUpdate.meetingState.isVideoOn,e.isHandRaised=n.meetingUpdate.meetingState.isHandRaised,e.isInMeeting=n.meetingUpdate.meetingState.isInMeeting,e.isRecordingOn=n.meetingUpdate.meetingState.isRecordingOn,e.isBackgroundBlurred=n.meetingUpdate.meetingState.isBackgroundBlurred,e.isSharing=n.meetingUpdate.meetingState.isSharing,e.hasUnreadMessages=n.meetingUpdate.meetingState.hasUnreadMessages),null!=n.meetingUpdate.meetingPermissions&&(e.canToggleMute=n.meetingUpdate.meetingPermissions.canToggleMute,e.canToggleVideo=n.meetingUpdate.meetingPermissions.canToggleVideo,e.canToggleHand=n.meetingUpdate.meetingPermissions.canToggleHand,e.canToggleBlur=n.meetingUpdate.meetingPermissions.canToggleBlur,e.canLeave=n.meetingUpdate.meetingPermissions.canLeave,e.canReact=n.meetingUpdate.meetingPermissions.canReact,e.canToggleShareTray=n.meetingUpdate.meetingPermissions.canToggleShareTray,e.canToggleChat=n.meetingUpdate.meetingPermissions.canToggleChat,e.canStopSharing=n.meetingUpdate.meetingPermissions.canStopSharing,e.canPair=n.meetingUpdate.meetingPermissions.canPair)}function o(e,n){let t=null;try{t=JSON.parse(n)}catch(e){t=n}null!=t.tokenRefresh&&(e.config.apiToken=t.tokenRefresh,e.saveConfig(e.config),e.configUpdated(e.config)),null!=t.meetingUpdate&&e.parseTeamsStatus(t)}function g(e){e.reconnect_timer&&(clearTimeout(e.reconnect_timer),e.reconnect_timer=null);const n="ws://"+e.config.targetIp+":8124?token="+e.config.apiToken+"&protocol-version=2.0.0&manufacturer=Bitfocus&device=Companion&app=Companion-Microsoft%20Teams&app-version=1.0.2";n&&e.config.targetIp?(e.updateStatus(a.InstanceStatus.Connecting),e.ws&&(e.ws.close(1e3),delete e.ws),e.ws=new i(n),e.ws.on("open",(()=>{e.updateStatus(a.InstanceStatus.Ok),e.ws.send("")})),e.ws.on("close",(n=>{1006==n?e.updateStatus(a.InstanceStatus.Disconnected,"Teams not running"):e.updateStatus(a.InstanceStatus.Disconnected,`Connection closed with code ${n}`),e.maybeReconnect()})),e.ws.on("message",(n=>{e.messageReceivedFromWebSocket(n)})),e.ws.on("error",(n=>{"Error: Unexpected server response: 403"==n?e.updateStatus(a.InstanceStatus.Disconnected,"Invalid API token or Teams not running"):e.log("error",`WebSocket error: ${n}`)}))):e.updateStatus(a.InstanceStatus.BadConfig,"No Target IP defined")}}};